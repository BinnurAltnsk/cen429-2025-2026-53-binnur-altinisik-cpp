<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.9.7" xml:lang="en-US">
  <compounddef id="softhsm_8cpp" kind="file" language="C++">
    <compoundname>softhsm.cpp</compoundname>
    <includes refid="softhsm_8h" local="yes">../header/softhsm.h</includes>
    <includes refid="safe__string_8h" local="yes">../header/safe_string.h</includes>
    <includes local="yes">../third_party/pkcs11/pkcs11.h</includes>
    <includes local="no">cstring</includes>
    <includes local="no">vector</includes>
    <includes local="no">memory</includes>
    <includes local="no">cstdio</includes>
    <includes local="no">unistd.h</includes>
    <includes local="no">dlfcn.h</includes>
    <incdepgraph>
      <node id="11">
        <label>../third_party/pkcs11/pkcs11.h</label>
      </node>
      <node id="3">
        <label>commonTypes.h</label>
        <link refid="common_types_8h"/>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="5" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="7" relation="include">
        </childnode>
      </node>
      <node id="7">
        <label>error_codes.h</label>
        <link refid="error__codes_8h"/>
      </node>
      <node id="8">
        <label>export.h</label>
        <link refid="export_8h"/>
      </node>
      <node id="10">
        <label>../header/safe_string.h</label>
        <link refid="safe__string_8h"/>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
      </node>
      <node id="2">
        <label>../header/softhsm.h</label>
        <link refid="softhsm_8h"/>
        <childnode refid="3" relation="include">
        </childnode>
        <childnode refid="8" relation="include">
        </childnode>
        <childnode refid="4" relation="include">
        </childnode>
        <childnode refid="9" relation="include">
        </childnode>
      </node>
      <node id="1">
        <label>src/travelexpense/src/softhsm.cpp</label>
        <link refid="softhsm_8cpp"/>
        <childnode refid="2" relation="include">
        </childnode>
        <childnode refid="10" relation="include">
        </childnode>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="6" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
        <childnode refid="16" relation="include">
        </childnode>
      </node>
      <node id="9">
        <label>cstddef</label>
      </node>
      <node id="4">
        <label>cstdint</label>
      </node>
      <node id="14">
        <label>cstdio</label>
      </node>
      <node id="6">
        <label>cstring</label>
      </node>
      <node id="5">
        <label>ctime</label>
      </node>
      <node id="16">
        <label>dlfcn.h</label>
      </node>
      <node id="13">
        <label>memory</label>
      </node>
      <node id="15">
        <label>unistd.h</label>
      </node>
      <node id="12">
        <label>vector</label>
      </node>
    </incdepgraph>
    <innernamespace refid="namespace_travel_expense">TravelExpense</innernamespace>
    <innernamespace refid="namespace_travel_expense_1_1_soft_h_s_m">TravelExpense::SoftHSM</innernamespace>
      <sectiondef kind="define">
      <memberdef kind="define" id="softhsm_8cpp_1a1abc5e0851defa37515dd9da299f411e" prot="public" static="no">
        <name>PKCS11_NO_EXPORTS</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="17" column="11" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="17" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="softhsm_8cpp_1a4bdc0245afe661f69ff2948076aaaf1b" prot="public" static="no">
        <name>FILE_EXISTS</name>
        <param><defname>path</defname></param>
        <initializer>file_exists_helper(path)</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="44" column="9" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="44" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="softhsm_8cpp_1a3b81e0f561932d8761fb8675437e2659" prot="public" static="no">
        <name>DL_HANDLE</name>
        <initializer>void*</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="65" column="15" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="65" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="softhsm_8cpp_1a1c69bc484d5f594765b1e700999dc470" prot="public" static="no">
        <name>DL_OPEN</name>
        <param><defname>path</defname></param>
        <initializer>dlopen(path, RTLD_NOW)</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="66" column="11" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="66" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="softhsm_8cpp_1ac2c1c282afbcfd1fdda90bb1b922f97c" prot="public" static="no">
        <name>DL_CLOSE</name>
        <param><defname>handle</defname></param>
        <initializer>dlclose(handle)</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="67" column="11" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="67" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="softhsm_8cpp_1a292a39d6dd5417956880f1eb1b656ce5" prot="public" static="no">
        <name>DL_SYM</name>
        <param><defname>handle</defname></param>
        <param><defname>name</defname></param>
        <initializer>dlsym(handle, name)</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="68" column="11" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="68" bodyend="-1"/>
      </memberdef>
      <memberdef kind="define" id="softhsm_8cpp_1ac1374fad0b402b055ede739566f0957f" prot="public" static="no">
        <name>DL_ERROR</name>
        <param></param>
        <initializer>dlerror()</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="69" column="11" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="69" bodyend="-1"/>
      </memberdef>
      </sectiondef>
      <sectiondef kind="typedef">
      <memberdef kind="typedef" id="namespace_travel_expense_1_1_soft_h_s_m_1a6fb8347ca19497bb25f5f0a6e696d96f" prot="public" static="no">
        <type><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383dab" kindref="member">TravelExpense::ErrorCode</ref></type>
        <definition>using TravelExpense::SoftHSM::ErrorCode = typedef TravelExpense::ErrorCode</definition>
        <argsstring></argsstring>
        <name>ErrorCode</name>
        <qualifiedname>TravelExpense::SoftHSM::ErrorCode</qualifiedname>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="77" column="1" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="77" bodyend="-1"/>
      </memberdef>
      </sectiondef>
      <sectiondef kind="var">
      <memberdef kind="variable" id="namespace_travel_expense_1_1_soft_h_s_m_1a25b47e9b2a2df901ca4dc5044147214a" prot="public" static="yes" mutable="no">
        <type><ref refid="softhsm_8cpp_1a3b81e0f561932d8761fb8675437e2659" kindref="member">DL_HANDLE</ref></type>
        <definition>DL_HANDLE TravelExpense::SoftHSM::g_pkcs11Library</definition>
        <argsstring></argsstring>
        <name>g_pkcs11Library</name>
        <qualifiedname>TravelExpense::SoftHSM::g_pkcs11Library</qualifiedname>
        <initializer>= nullptr</initializer>
        <briefdescription>
<para>Global state variables for <ref refid="namespace_travel_expense_1_1_soft_h_s_m" kindref="compound">SoftHSM</ref> module. </para>
        </briefdescription>
        <detaileddescription>
<para>Bu global değişkenler, <ref refid="namespace_travel_expense_1_1_soft_h_s_m" kindref="compound">SoftHSM</ref> modülünün durumunu saklar. Singleton pattern kullanılarak tek bir PKCS#11 bağlantısı yönetilir.</para>
<para>PKCS#11 dinamik kütüphane handle&apos;ı (Windows: HMODULE, Linux: void*) </para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="86" column="18" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="86" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="namespace_travel_expense_1_1_soft_h_s_m_1aaeba772df23a3ca6603606546f2bceb1" prot="public" static="yes" mutable="no">
        <type>CK_FUNCTION_LIST *</type>
        <definition>CK_FUNCTION_LIST* TravelExpense::SoftHSM::g_pFunctionList</definition>
        <argsstring></argsstring>
        <name>g_pFunctionList</name>
        <qualifiedname>TravelExpense::SoftHSM::g_pFunctionList</qualifiedname>
        <initializer>= nullptr</initializer>
        <briefdescription>
<para>PKCS#11 function list pointer&apos;ı - C_GetFunctionList ile alınır. </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="88" column="25" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="88" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="namespace_travel_expense_1_1_soft_h_s_m_1ae9e5e1f09fca7edbf90a13dffd07c6ec" prot="public" static="yes" mutable="no">
        <type>CK_SLOT_ID</type>
        <definition>CK_SLOT_ID TravelExpense::SoftHSM::g_currentSlot</definition>
        <argsstring></argsstring>
        <name>g_currentSlot</name>
        <qualifiedname>TravelExpense::SoftHSM::g_currentSlot</qualifiedname>
        <initializer>= 0</initializer>
        <briefdescription>
<para>Mevcut token slot ID&apos;si - <ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a1dd53afa782d6054163658a225a3e3bf" kindref="member">openToken()</ref> ile ayarlanır. </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="90" column="19" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="90" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="namespace_travel_expense_1_1_soft_h_s_m_1a09efc2a51c5b4224c51861d960ed0bf2" prot="public" static="yes" mutable="no">
        <type>CK_SESSION_HANDLE</type>
        <definition>CK_SESSION_HANDLE TravelExpense::SoftHSM::g_sessionHandle</definition>
        <argsstring></argsstring>
        <name>g_sessionHandle</name>
        <qualifiedname>TravelExpense::SoftHSM::g_sessionHandle</qualifiedname>
        <initializer>= 0</initializer>
        <briefdescription>
<para>Açık PKCS#11 session handle&apos;ı - <ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a1dd53afa782d6054163658a225a3e3bf" kindref="member">openToken()</ref> ile açılır. </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="92" column="26" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="92" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="namespace_travel_expense_1_1_soft_h_s_m_1a4360df71e0a4fcf4686308a1a79d8807" prot="public" static="yes" mutable="no">
        <type>InitStatus</type>
        <definition>InitStatus TravelExpense::SoftHSM::g_status</definition>
        <argsstring></argsstring>
        <name>g_status</name>
        <qualifiedname>TravelExpense::SoftHSM::g_status</qualifiedname>
        <initializer>= InitStatus::NOT_INITIALIZED</initializer>
        <briefdescription>
<para><ref refid="namespace_travel_expense_1_1_soft_h_s_m" kindref="compound">SoftHSM</ref> başlatma durumu - <ref refid="namespace_travel_expense_1_1_soft_h_s_m_1af71b3824984e7e34e84fc5c0a606b418" kindref="member">initialize()</ref> ve <ref refid="namespace_travel_expense_1_1_soft_h_s_m_1aa08cccf8f5db8d63231a3b706351b212" kindref="member">shutdown()</ref> ile yönetilir. </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="94" column="19" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="94" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="namespace_travel_expense_1_1_soft_h_s_m_1ac2a97453e170a334157072ebf27b6afe" prot="public" static="yes" mutable="no">
        <type>char</type>
        <definition>char TravelExpense::SoftHSM::g_tokenLabel[64]</definition>
        <argsstring>[64]</argsstring>
        <name>g_tokenLabel</name>
        <qualifiedname>TravelExpense::SoftHSM::g_tokenLabel</qualifiedname>
        <initializer>= { 0 }</initializer>
        <briefdescription>
<para>Token label - <ref refid="namespace_travel_expense_1_1_soft_h_s_m_1af71b3824984e7e34e84fc5c0a606b418" kindref="member">initialize()</ref> veya <ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a0d330cfb5deff1a7731392c78c8a4757" kindref="member">createToken()</ref> ile ayarlanır (max 64 karakter) </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="96" column="13" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="96" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="namespace_travel_expense_1_1_soft_h_s_m_1a18fb49db0706ae6bc570f9054425004d" prot="public" static="yes" mutable="no">
        <type>char</type>
        <definition>char TravelExpense::SoftHSM::g_pin[32]</definition>
        <argsstring>[32]</argsstring>
        <name>g_pin</name>
        <qualifiedname>TravelExpense::SoftHSM::g_pin</qualifiedname>
        <initializer>= { 0 }</initializer>
        <briefdescription>
<para>Token PIN - <ref refid="namespace_travel_expense_1_1_soft_h_s_m_1af71b3824984e7e34e84fc5c0a606b418" kindref="member">initialize()</ref> veya <ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a0d330cfb5deff1a7731392c78c8a4757" kindref="member">createToken()</ref> ile ayarlanır (max 32 karakter) </para>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="98" column="13" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="98" bodyend="-1"/>
      </memberdef>
      </sectiondef>
      <sectiondef kind="func">
      <memberdef kind="function" id="softhsm_8cpp_1a10f23ed946357e78d5d1b9a75dea7c33" prot="public" static="yes" const="no" explicit="no" inline="yes" virt="non-virtual">
        <type>int</type>
        <definition>static int file_exists_helper</definition>
        <argsstring>(const char *path)</argsstring>
        <name>file_exists_helper</name>
        <param>
          <type>const char *</type>
          <declname>path</declname>
        </param>
        <briefdescription>
<para>Linux için dosya varlık kontrolü helper fonksiyonu. </para>
        </briefdescription>
        <detaileddescription>
<para>Bu fonksiyon, belirtilen dosya yolunun var olup olmadığını kontrol eder. Platform-specific code for non-Windows platforms - not executed on Windows. This code is excluded from coverage on Windows builds.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>path</parametername>
</parameternamelist>
<parameterdescription>
<para>Kontrol edilecek dosya yolu </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>0 Dosya varsa, -1 Dosya yoksa </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="41" column="19" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="41" bodyend="43"/>
      </memberdef>
      <memberdef kind="function" id="namespace_travel_expense_1_1_soft_h_s_m_1a45bb7e36eb2dcea9e98bd740d17463f1" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>ErrorCode</type>
        <definition>static ErrorCode TravelExpense::SoftHSM::pkcs11ToErrorCode</definition>
        <argsstring>(CK_ULONG rv)</argsstring>
        <name>pkcs11ToErrorCode</name>
        <qualifiedname>TravelExpense::SoftHSM::pkcs11ToErrorCode</qualifiedname>
        <param>
          <type>CK_ULONG</type>
          <declname>rv</declname>
        </param>
        <briefdescription>
<para>PKCS#11 return code&apos;unu ErrorCode&apos;a çevir. </para>
        </briefdescription>
        <detaileddescription>
<para>Bu helper fonksiyon, PKCS#11 standardından dönen return code&apos;ları uygulamanın ErrorCode enum&apos;una çevirir. PKCS#11 hata kodları CKR_* formatında olup, bunlar uygulama seviyesinde daha anlamlı hata kodlarına dönüştürülür.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>rv</parametername>
</parameternamelist>
<parameterdescription>
<para>PKCS#11 return code (CK_ULONG) </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>ErrorCode Uygulama seviyesinde hata kodu </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="111" column="18" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="111" bodyend="142"/>
      </memberdef>
      <memberdef kind="function" id="namespace_travel_expense_1_1_soft_h_s_m_1ad8c0a39f841e627e3ebc2a1a840e2fd9" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>const char *</type>
        <definition>static const char * TravelExpense::SoftHSM::findSoftHSMLibrary</definition>
        <argsstring>()</argsstring>
        <name>findSoftHSMLibrary</name>
        <qualifiedname>TravelExpense::SoftHSM::findSoftHSMLibrary</qualifiedname>
        <briefdescription>
<para><ref refid="namespace_travel_expense_1_1_soft_h_s_m" kindref="compound">SoftHSM</ref> kütüphanesi yolunu bul. </para>
        </briefdescription>
        <detaileddescription>
<para>Bu helper fonksiyon, sistemde yüklü <ref refid="namespace_travel_expense_1_1_soft_h_s_m" kindref="compound">SoftHSM</ref> kütüphanesini bulur. Platform-specific varsayılan yolları kontrol eder ve ilk bulunan kütüphane yolunu döndürür.</para>
<para>Windows için kontrol edilen yollar:<itemizedlist>
<listitem><para>softhsm2.dll (current directory)</para>
</listitem><listitem><para>C:\Program Files\SoftHSM2\lib\softhsm2.dll</para>
</listitem><listitem><para>C:\Program Files (x86)\SoftHSM2\lib\softhsm2.dll</para>
</listitem></itemizedlist>
</para>
<para>Linux için kontrol edilen yollar:<itemizedlist>
<listitem><para>libsofthsm2.so (current directory)</para>
</listitem><listitem><para>/usr/lib/softhsm/libsofthsm2.so</para>
</listitem><listitem><para>/usr/local/lib/softhsm/libsofthsm2.so</para>
</listitem><listitem><para>/usr/lib/x86_64-linux-gnu/softhsm/libsofthsm2.so</para>
</listitem><listitem><para>/opt/softhsm2/lib/libsofthsm2.so</para>
</listitem></itemizedlist>
</para>
<para><simplesect kind="return"><para>const char* Bulunan kütüphane yolu, bulunamazsa nullptr </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="165" column="19" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="165" bodyend="204"/>
      </memberdef>
      <memberdef kind="function" id="namespace_travel_expense_1_1_soft_h_s_m_1aec8dc7984165792e83c0e751aa6db093" prot="public" static="yes" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>ErrorCode</type>
        <definition>static ErrorCode TravelExpense::SoftHSM::loadPKCS11Library</definition>
        <argsstring>(const char *libraryPath)</argsstring>
        <name>loadPKCS11Library</name>
        <qualifiedname>TravelExpense::SoftHSM::loadPKCS11Library</qualifiedname>
        <param>
          <type>const char *</type>
          <declname>libraryPath</declname>
        </param>
        <briefdescription>
<para>PKCS#11 kütüphanesini yükle. </para>
        </briefdescription>
        <detaileddescription>
<para>Bu helper fonksiyon, PKCS#11 kütüphanesini dinamik olarak yükler. Eğer kütüphane zaten yüklüyse, hiçbir işlem yapmaz ve Success döner. Eğer libraryPath nullptr ise, findSoftHSMLibrary() ile otomatik bulma yapar.</para>
<para>Kütüphane yüklendikten sonra, C_GetFunctionList fonksiyonunu alır ve PKCS#11 function list&apos;ini initialize eder. Bu işlem başarısız olursa, kütüphane kapatılır ve hata kodu döner.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>libraryPath</parametername>
</parameternamelist>
<parameterdescription>
<para>PKCS#11 kütüphanesi yolu (nullptr ise otomatik bulma yapılır) </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>ErrorCode Başarı durumu (Success, FileNotFound, Unknown) </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="220" column="18" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="220" bodyend="262"/>
      </memberdef>
      <memberdef kind="function" id="namespace_travel_expense_1_1_soft_h_s_m_1af71b3824984e7e34e84fc5c0a606b418" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="export_8h_1a21d78c0dc6e2907cbb76e2b0468cceb6" kindref="member">TRAVELEXPENSE_API</ref> ErrorCode</type>
        <definition>ErrorCode TravelExpense::SoftHSM::initialize</definition>
        <argsstring>(const char *libraryPath=nullptr, const char *tokenLabel=nullptr, const char *pin=nullptr)</argsstring>
        <name>initialize</name>
        <qualifiedname>TravelExpense::SoftHSM::initialize</qualifiedname>
        <param>
          <type>const char *</type>
          <declname>libraryPath</declname>
          <defval>nullptr</defval>
        </param>
        <param>
          <type>const char *</type>
          <declname>tokenLabel</declname>
          <defval>nullptr</defval>
        </param>
        <param>
          <type>const char *</type>
          <declname>pin</declname>
          <defval>nullptr</defval>
        </param>
        <briefdescription>
<para><ref refid="namespace_travel_expense_1_1_soft_h_s_m" kindref="compound">SoftHSM</ref>&apos;yi başlat ve PKCS#11 kütüphanesini yükle. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>libraryPath</parametername>
</parameternamelist>
<parameterdescription>
<para><ref refid="namespace_travel_expense_1_1_soft_h_s_m" kindref="compound">SoftHSM</ref> PKCS#11 kütüphanesi yolu (nullptr ise otomatik bulma yapılır) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>tokenLabel</parametername>
</parameternamelist>
<parameterdescription>
<para>Token etiketi (nullptr ise varsayılan token oluşturulur) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>pin</parametername>
</parameternamelist>
<parameterdescription>
<para>PIN kodu (nullptr ise varsayılan &quot;1234&quot; kullanılır) </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>ErrorCode Başarı durumu</para>
</simplesect>
</para>
<para><ref refid="namespace_travel_expense_1_1_soft_h_s_m" kindref="compound">SoftHSM</ref> modülünü başlatır ve belirtilen PKCS#11 kütüphanesini yükler. Eğer <computeroutput>libraryPath</computeroutput> nullptr ise, sistemdeki varsayılan kütüphane aranır. <computeroutput>tokenLabel</computeroutput> ve <computeroutput>pin</computeroutput> nullptr ise varsayılan değerler kullanılır.</para>
<para><simplesect kind="note"><para>Bu fonksiyon, zaten başlatılmışsa (<ref refid="namespace_travel_expense_1_1_soft_h_s_m_1aad0a58fc42af71a6793bf6449a75b24aadee5f03c2c4e73657824e028494b18c0" kindref="member">InitStatus::INITIALIZED</ref>) hiçbir işlem yapmaz ve Success döner. PKCS#11 kütüphanesi yüklendikten sonra, C_Initialize() çağrılır ve token label ile PIN kaydedilir.</para>
</simplesect>
<parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>libraryPath</parametername>
</parameternamelist>
<parameterdescription>
<para><ref refid="namespace_travel_expense_1_1_soft_h_s_m" kindref="compound">SoftHSM</ref> PKCS#11 kütüphanesi yolu (nullptr ise otomatik bulma yapılır) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>tokenLabel</parametername>
</parameternamelist>
<parameterdescription>
<para>Token etiketi (nullptr ise varsayılan &quot;TravelExpense&quot; kullanılır) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>pin</parametername>
</parameternamelist>
<parameterdescription>
<para>PIN kodu (nullptr ise varsayılan &quot;1234&quot; kullanılır) </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>ErrorCode Başarı durumu </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="280" column="11" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="280" bodyend="317" declfile="src/travelexpense/header/softhsm.h" declline="70" declcolumn="29"/>
      </memberdef>
      <memberdef kind="function" id="namespace_travel_expense_1_1_soft_h_s_m_1aa08cccf8f5db8d63231a3b706351b212" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="export_8h_1a21d78c0dc6e2907cbb76e2b0468cceb6" kindref="member">TRAVELEXPENSE_API</ref> ErrorCode</type>
        <definition>ErrorCode TravelExpense::SoftHSM::shutdown</definition>
        <argsstring>()</argsstring>
        <name>shutdown</name>
        <qualifiedname>TravelExpense::SoftHSM::shutdown</qualifiedname>
        <briefdescription>
<para><ref refid="namespace_travel_expense_1_1_soft_h_s_m" kindref="compound">SoftHSM</ref>&apos;yi kapat ve kaynakları temizle. </para>
        </briefdescription>
        <detaileddescription>
<para><simplesect kind="return"><para>ErrorCode Başarı durumu</para>
</simplesect>
</para>
<para><ref refid="namespace_travel_expense_1_1_soft_h_s_m" kindref="compound">SoftHSM</ref> modülünü kapatır ve tüm kaynakları temizler. Açık session varsa kapatılır, PKCS#11 finalize edilir ve dinamik kütüphane kapatılır. Token label ve PIN bilgileri güvenli şekilde temizlenir.</para>
<para><simplesect kind="note"><para>Bu fonksiyon, zaten kapatılmışsa (<ref refid="namespace_travel_expense_1_1_soft_h_s_m_1aad0a58fc42af71a6793bf6449a75b24aa02de9649e258d1dd94056e676061e969" kindref="member">InitStatus::NOT_INITIALIZED</ref>) hiçbir işlem yapmaz ve Success döner.</para>
</simplesect>
<simplesect kind="return"><para>ErrorCode Başarı durumu </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="331" column="11" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="331" bodyend="358" declfile="src/travelexpense/header/softhsm.h" declline="79" declcolumn="29"/>
      </memberdef>
      <memberdef kind="function" id="namespace_travel_expense_1_1_soft_h_s_m_1a0fa272e6522244baa0af55f77332e6f5" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="export_8h_1a21d78c0dc6e2907cbb76e2b0468cceb6" kindref="member">TRAVELEXPENSE_API</ref> InitStatus</type>
        <definition>InitStatus TravelExpense::SoftHSM::getStatus</definition>
        <argsstring>()</argsstring>
        <name>getStatus</name>
        <qualifiedname>TravelExpense::SoftHSM::getStatus</qualifiedname>
        <briefdescription>
<para><ref refid="namespace_travel_expense_1_1_soft_h_s_m" kindref="compound">SoftHSM</ref> başlatma durumunu kontrol et. </para>
        </briefdescription>
        <detaileddescription>
<para><simplesect kind="return"><para>InitStatus Başlatma durumu</para>
</simplesect>
</para>
<para><ref refid="namespace_travel_expense_1_1_soft_h_s_m" kindref="compound">SoftHSM</ref> modülünün mevcut başlatma durumunu döndürür.</para>
<para><simplesect kind="return"><para>InitStatus Mevcut durum (NOT_INITIALIZED, INITIALIZED, ERROR) </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="367" column="12" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="367" bodyend="369" declfile="src/travelexpense/header/softhsm.h" declline="86" declcolumn="30"/>
      </memberdef>
      <memberdef kind="function" id="namespace_travel_expense_1_1_soft_h_s_m_1a0d330cfb5deff1a7731392c78c8a4757" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="export_8h_1a21d78c0dc6e2907cbb76e2b0468cceb6" kindref="member">TRAVELEXPENSE_API</ref> ErrorCode</type>
        <definition>ErrorCode TravelExpense::SoftHSM::createToken</definition>
        <argsstring>(const char *label, const char *pin, const char *soPin)</argsstring>
        <name>createToken</name>
        <qualifiedname>TravelExpense::SoftHSM::createToken</qualifiedname>
        <param>
          <type>const char *</type>
          <declname>label</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>pin</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>soPin</declname>
        </param>
        <briefdescription>
<para>Token oluştur (eğer yoksa) </para>
        </briefdescription>
        <detaileddescription>
<para>Token oluştur (simplified - gerçek implementasyonda token creation gerekir)</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>label</parametername>
</parameternamelist>
<parameterdescription>
<para>Token etiketi </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>pin</parametername>
</parameternamelist>
<parameterdescription>
<para>PIN kodu </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>soPin</parametername>
</parameternamelist>
<parameterdescription>
<para><ref refid="namespace_travel_expense_1_1_security" kindref="compound">Security</ref> Officer PIN kodu </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>ErrorCode Başarı durumu</para>
</simplesect>
</para>
<para><ref refid="namespace_travel_expense_1_1_soft_h_s_m" kindref="compound">SoftHSM</ref> token&apos;ları genellikle sistem seviyesinde oluşturulur. Bu fonksiyon sadece token label ve PIN bilgilerini kaydeder. Gerçek token oluşturma işlemi için <ref refid="namespace_travel_expense_1_1_soft_h_s_m" kindref="compound">SoftHSM</ref> CLI komutları gerekir.</para>
<para><simplesect kind="note"><para>Bu fonksiyon, simplified bir implementasyon olup gerçek token oluşturma işlemini yapmaz. Sadece parametreleri saklar.</para>
</simplesect>
<parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>label</parametername>
</parameternamelist>
<parameterdescription>
<para>Token etiketi (nullptr ise InvalidInput döner) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>pin</parametername>
</parameternamelist>
<parameterdescription>
<para>PIN kodu (nullptr ise InvalidInput döner) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>soPin</parametername>
</parameternamelist>
<parameterdescription>
<para>SO (<ref refid="namespace_travel_expense_1_1_security" kindref="compound">Security</ref> Officer) PIN kodu (kullanılmıyor, nullptr olabilir) </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>ErrorCode Başarı durumu </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="386" column="11" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="386" bodyend="398" declfile="src/travelexpense/header/softhsm.h" declline="96" declcolumn="29"/>
      </memberdef>
      <memberdef kind="function" id="namespace_travel_expense_1_1_soft_h_s_m_1a1dd53afa782d6054163658a225a3e3bf" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="export_8h_1a21d78c0dc6e2907cbb76e2b0468cceb6" kindref="member">TRAVELEXPENSE_API</ref> ErrorCode</type>
        <definition>ErrorCode TravelExpense::SoftHSM::openToken</definition>
        <argsstring>(const char *label, const char *pin)</argsstring>
        <name>openToken</name>
        <qualifiedname>TravelExpense::SoftHSM::openToken</qualifiedname>
        <param>
          <type>const char *</type>
          <declname>label</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>pin</declname>
        </param>
        <briefdescription>
<para>Token aç (oturum başlat) </para>
        </briefdescription>
        <detaileddescription>
<para>Token aç ve session başlat.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>label</parametername>
</parameternamelist>
<parameterdescription>
<para>Token etiketi (nullptr ise varsayılan token) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>pin</parametername>
</parameternamelist>
<parameterdescription>
<para>PIN kodu </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>ErrorCode Başarı durumu</para>
</simplesect>
</para>
<para>Belirtilen token&apos;ı açar ve PKCS#11 session başlatır. Token label&apos;a göre slot listesinde token aranır, bulunduktan sonra session açılır ve PIN ile login yapılır.</para>
<para><simplesect kind="note"><para>Bu fonksiyon, <ref refid="namespace_travel_expense_1_1_soft_h_s_m" kindref="compound">SoftHSM</ref>&apos;nin INITIALIZED durumunda olmasını gerektirir. Eğer label nullptr ise, kaydedilmiş g_tokenLabel kullanılır. Eğer pin nullptr ise, kaydedilmiş g_pin kullanılır.</para>
</simplesect>
<parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>label</parametername>
</parameternamelist>
<parameterdescription>
<para>Token etiketi (nullptr ise kaydedilmiş label kullanılır) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>pin</parametername>
</parameternamelist>
<parameterdescription>
<para>PIN kodu (nullptr ise kaydedilmiş PIN kullanılır) </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>ErrorCode Başarı durumu </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
<para>Slot listesi alma</para>
<para>C_GetSlotList ile token içeren slot&apos;ların listesi alınır. İlk çağrıda slot sayısı alınır, ikinci çağrıda slot ID&apos;leri alınır.</para>
<para>&lt; Token içeren slot sayısı (çıktı)</para>
<para>&lt; Slot ID&apos;leri dizisi</para>
<para>Label&apos;a göre token bulma</para>
<para>Her slot&apos;taki token&apos;ın label&apos;ı kontrol edilir ve aranan label ile karşılaştırılır. Token label&apos;ları PKCS#11&apos;de null-terminated değildir, boşluklarla doldurulmuş olabilir, bu nedenle temizlenir.</para>
<para>&lt; Varsayılan olarak ilk slot</para>
<para>&lt; Aranacak token label</para>
<para>Token label karşılaştırması</para>
<para>Her slot&apos;taki token&apos;ın label&apos;ı C_GetTokenInfo ile alınır ve aranan label ile karşılaştırılır. Eşleşme bulunursa, o slot seçilir.</para>
<para>PKCS#11 session açma</para>
<para>Seçilen slot&apos;ta read-write session açılır. CKF_RW_SESSION flag&apos;i ile yazma işlemleri yapılabilir, CKF_SERIAL_SESSION flag&apos;i ile serial session açılır (paralel session değil).</para>
<para>&lt; Read-write ve serial session flag&apos;leri</para>
<para>PIN ile login</para>
<para>Kullanıcı PIN&apos;i ile token&apos;a login yapılır. CKU_USER ile normal kullanıcı olarak login yapılır. Eğer zaten login yapılmışsa (CKR_USER_ALREADY_LOGGED_IN), hata olarak kabul edilmez.</para>
<para>&lt; Kullanılacak PIN (parametre veya kaydedilmiş)</para>
<para>Slot listesi alma</para>
<para>C_GetSlotList ile token içeren slot&apos;ların listesi alınır. İlk çağrıda slot sayısı alınır, ikinci çağrıda slot ID&apos;leri alınır.</para>
<para>&lt; Token içeren slot sayısı (çıktı)</para>
<para>&lt; Slot ID&apos;leri dizisi</para>
<para>Label&apos;a göre token bulma</para>
<para>Her slot&apos;taki token&apos;ın label&apos;ı kontrol edilir ve aranan label ile karşılaştırılır. Token label&apos;ları PKCS#11&apos;de null-terminated değildir, boşluklarla doldurulmuş olabilir, bu nedenle temizlenir.</para>
<para>&lt; Varsayılan olarak ilk slot</para>
<para>&lt; Aranacak token label</para>
<para>Token label karşılaştırması</para>
<para>Her slot&apos;taki token&apos;ın label&apos;ı C_GetTokenInfo ile alınır ve aranan label ile karşılaştırılır. Eşleşme bulunursa, o slot seçilir.</para>
<para>PKCS#11 session açma</para>
<para>Seçilen slot&apos;ta read-write session açılır. CKF_RW_SESSION flag&apos;i ile yazma işlemleri yapılabilir, CKF_SERIAL_SESSION flag&apos;i ile serial session açılır (paralel session değil).</para>
<para>&lt; Read-write ve serial session flag&apos;leri</para>
<para>PIN ile login</para>
<para>Kullanıcı PIN&apos;i ile token&apos;a login yapılır. CKU_USER ile normal kullanıcı olarak login yapılır. Eğer zaten login yapılmışsa (CKR_USER_ALREADY_LOGGED_IN), hata olarak kabul edilmez.</para>
<para>&lt; Kullanılacak PIN (parametre veya kaydedilmiş)</para>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="415" column="11" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="415" bodyend="516" declfile="src/travelexpense/header/softhsm.h" declline="105" declcolumn="29"/>
      </memberdef>
      <memberdef kind="function" id="namespace_travel_expense_1_1_soft_h_s_m_1a355d45677c9adebfb9afa591275bb8d4" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="export_8h_1a21d78c0dc6e2907cbb76e2b0468cceb6" kindref="member">TRAVELEXPENSE_API</ref> ErrorCode</type>
        <definition>ErrorCode TravelExpense::SoftHSM::closeToken</definition>
        <argsstring>()</argsstring>
        <name>closeToken</name>
        <qualifiedname>TravelExpense::SoftHSM::closeToken</qualifiedname>
        <briefdescription>
<para>Token&apos;ı kapat (oturum kapat) </para>
        </briefdescription>
        <detaileddescription>
<para>Token kapat ve session&apos;ı sonlandır.</para>
<para><simplesect kind="return"><para>ErrorCode Başarı durumu</para>
</simplesect>
</para>
<para>Açık token session&apos;ını kapatır. Önce logout yapılır, sonra session kapatılır. Session handle ve current slot sıfırlanır.</para>
<para><simplesect kind="note"><para>Bu fonksiyon, session açık değilse hiçbir işlem yapmaz ve Success döner.</para>
</simplesect>
<simplesect kind="return"><para>ErrorCode Başarı durumu </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="528" column="11" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="528" bodyend="538" declfile="src/travelexpense/header/softhsm.h" declline="112" declcolumn="29"/>
      </memberdef>
      <memberdef kind="function" id="namespace_travel_expense_1_1_soft_h_s_m_1a100a3043a4e2c9d8cd6922248a46f335" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="export_8h_1a21d78c0dc6e2907cbb76e2b0468cceb6" kindref="member">TRAVELEXPENSE_API</ref> ErrorCode</type>
        <definition>ErrorCode TravelExpense::SoftHSM::generateKey</definition>
        <argsstring>(KeyType keyType, KeyUsage keyUsage, const char *keyLabel, uint8_t *keyId, size_t &amp;keyIdLen)</argsstring>
        <name>generateKey</name>
        <qualifiedname>TravelExpense::SoftHSM::generateKey</qualifiedname>
        <param>
          <type>KeyType</type>
          <declname>keyType</declname>
        </param>
        <param>
          <type>KeyUsage</type>
          <declname>keyUsage</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>keyLabel</declname>
        </param>
        <param>
          <type>uint8_t *</type>
          <declname>keyId</declname>
        </param>
        <param>
          <type>size_t &amp;</type>
          <declname>keyIdLen</declname>
        </param>
        <briefdescription>
<para>Anahtar oluştur (generate key) </para>
        </briefdescription>
        <detaileddescription>
<para>Kriptografik anahtar oluştur.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>keyType</parametername>
</parameternamelist>
<parameterdescription>
<para>Anahtar tipi (AES, RSA, EC) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>keyUsage</parametername>
</parameternamelist>
<parameterdescription>
<para>Anahtar kullanım amacı </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>keyLabel</parametername>
</parameternamelist>
<parameterdescription>
<para>Anahtar etiketi (identifier) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>keyId</parametername>
</parameternamelist>
<parameterdescription>
<para>Çıktı: Oluşturulan anahtar ID&apos;si </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>ErrorCode Başarı durumu</para>
</simplesect>
</para>
<para>Belirtilen tipte ve kullanım amacına göre kriptografik anahtar oluşturur. Desteklenen anahtar tipleri: AES-256, RSA-2048, EC-P256. Anahtar, token üzerinde saklanır ve keyId olarak döndürülür.</para>
<para><simplesect kind="note"><para>Bu fonksiyon, açık bir session gerektirir (<ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a1dd53afa782d6054163658a225a3e3bf" kindref="member">openToken()</ref> çağrılmış olmalı). Simetrik anahtarlar (AES) için C_GenerateKey, asimetrik anahtarlar (RSA, EC) için C_GenerateKeyPair kullanılır.</para>
</simplesect>
<parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>keyType</parametername>
</parameternamelist>
<parameterdescription>
<para>Anahtar tipi (AES_256, RSA_2048, EC_P256) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>keyUsage</parametername>
</parameternamelist>
<parameterdescription>
<para>Anahtar kullanım amacı (ENCRYPT_DECRYPT, SIGN_VERIFY, vb.) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>keyLabel</parametername>
</parameternamelist>
<parameterdescription>
<para>Anahtar etiketi (nullptr ise InvalidInput döner) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>keyId</parametername>
</parameternamelist>
<parameterdescription>
<para>Oluşturulan anahtarın ID&apos;si (çıktı, nullptr ise InvalidInput döner) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>keyIdLen</parametername>
</parameternamelist>
<parameterdescription>
<para>keyId buffer boyutu (giriş), oluşturulan ID boyutu (çıktı) </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>ErrorCode Başarı durumu </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
<para>PKCS#11 mekanizma ve attribute template oluşturma</para>
<para>Key type&apos;a göre uygun PKCS#11 mekanizması ve attribute template&apos;leri oluşturulur. Her anahtar tipi için farklı mekanizma ve key class kullanılır.</para>
<para>&lt; Varsayılan: Secret key (AES için)</para>
<para>&lt; Varsayılan: AES key type</para>
<para>&lt; 32 bytes for AES-256</para>
<para>Anahtar tipine göre PKCS#11 mekanizması ve key class ayarlama</para>
<para>Her anahtar tipi için farklı PKCS#11 mekanizması ve key class kullanılır:<itemizedlist>
<listitem><para>AES_256: CKM_AES_KEY_GEN, CKO_SECRET_KEY, CKK_AES</para>
</listitem><listitem><para>RSA_2048: CKM_RSA_PKCS_KEY_PAIR_GEN, CKO_PRIVATE_KEY, CKK_RSA</para>
</listitem><listitem><para>EC_P256: CKM_EC_KEY_PAIR_GEN, CKO_PRIVATE_KEY, CKK_EC</para>
</listitem></itemizedlist>
</para>
<para>PKCS#11 attribute template oluşturma</para>
<para>Anahtar özelliklerini belirten PKCS#11 attribute&apos;ları oluşturulur. Her attribute, anahtarın nasıl kullanılacağını ve saklanacağını belirtir.</para>
<para>&lt; Anahtar sınıfı (secret key veya private key)</para>
<para>&lt; Anahtar tipi (AES, RSA, EC)</para>
<para>&lt; Anahtar etiketi (kullanıcı tanımlı)</para>
<para>&lt; Boolean true değeri (PKCS#11 attribute&apos;ları için)</para>
<para>&lt; Boolean false değeri (kullanılmıyor)</para>
<para>&lt; Anahtar token&apos;da saklanacak (kalıcı)</para>
<para>&lt; Anahtar private (sadece PIN ile erişilebilir)</para>
<para>Key usage attributes - Anahtar kullanım amacına göre özellikler</para>
<para>Anahtarın hangi işlemler için kullanılabileceğini belirten attribute&apos;lar eklenir:<itemizedlist>
<listitem><para>ENCRYPT_DECRYPT: CKA_ENCRYPT ve CKA_DECRYPT attribute&apos;ları</para>
</listitem><listitem><para>SIGN_VERIFY: CKA_SIGN ve CKA_VERIFY attribute&apos;ları</para>
</listitem></itemizedlist>
</para>
<para>AES için key size attribute&apos;u</para>
<para>AES anahtarları için key size (256 bit = 32 byte) belirtilir. RSA ve EC anahtarları için key size attribute&apos;u gerekmez.</para>
<para>&lt; AES anahtar uzunluğu (32 byte)</para>
<para>PKCS#11 anahtar oluşturma</para>
<para>Simetrik anahtarlar (AES) için C_GenerateKey, asimetrik anahtarlar (RSA, EC) için C_GenerateKeyPair kullanılır. Key pair generation için public key template&apos;i de oluşturulmalıdır.</para>
<para>&lt; Oluşturulan anahtar handle&apos;ı</para>
<para>&lt; PKCS#11 return code</para>
<para>Key pair generation - Public key template</para>
<para>Asimetrik anahtarlar (RSA, EC) için public key template&apos;i oluşturulur. Public key template&apos;i, key class ve key type bilgilerini içerir.</para>
<para>&lt; Public key attribute template</para>
<para>&lt; Public key template attribute sayısı</para>
<para>Key ID oluşturma</para>
<para>Oluşturulan anahtarın handle&apos;ı keyId olarak kullanılır. Eğer keyId buffer yeterli büyüklükteyse (CK_OBJECT_HANDLE boyutu), handle kopyalanır. Aksi takdirde, label&apos;den hash oluşturulur.</para>
<para>Key ID buffer yeterli: handle&apos;ı kopyala</para>
<para>Key ID buffer küçük: label&apos;den hash oluştur</para>
<para>Bu durumda, label&apos;ın ilk N karakteri keyId olarak kullanılır. N, keyId buffer boyutu ve label uzunluğunun minimum&apos;udur.</para>
<para>PKCS#11 mekanizma ve attribute template oluşturma</para>
<para>Key type&apos;a göre uygun PKCS#11 mekanizması ve attribute template&apos;leri oluşturulur. Her anahtar tipi için farklı mekanizma ve key class kullanılır.</para>
<para>&lt; Varsayılan: Secret key (AES için)</para>
<para>&lt; Varsayılan: AES key type</para>
<para>&lt; 32 bytes for AES-256</para>
<para>Anahtar tipine göre PKCS#11 mekanizması ve key class ayarlama</para>
<para>Her anahtar tipi için farklı PKCS#11 mekanizması ve key class kullanılır:<itemizedlist>
<listitem><para>AES_256: CKM_AES_KEY_GEN, CKO_SECRET_KEY, CKK_AES</para>
</listitem><listitem><para>RSA_2048: CKM_RSA_PKCS_KEY_PAIR_GEN, CKO_PRIVATE_KEY, CKK_RSA</para>
</listitem><listitem><para>EC_P256: CKM_EC_KEY_PAIR_GEN, CKO_PRIVATE_KEY, CKK_EC</para>
</listitem></itemizedlist>
</para>
<para>PKCS#11 attribute template oluşturma</para>
<para>Anahtar özelliklerini belirten PKCS#11 attribute&apos;ları oluşturulur. Her attribute, anahtarın nasıl kullanılacağını ve saklanacağını belirtir.</para>
<para>&lt; Anahtar sınıfı (secret key veya private key)</para>
<para>&lt; Anahtar tipi (AES, RSA, EC)</para>
<para>&lt; Anahtar etiketi (kullanıcı tanımlı)</para>
<para>&lt; Boolean true değeri (PKCS#11 attribute&apos;ları için)</para>
<para>&lt; Boolean false değeri (kullanılmıyor)</para>
<para>&lt; Anahtar token&apos;da saklanacak (kalıcı)</para>
<para>&lt; Anahtar private (sadece PIN ile erişilebilir)</para>
<para>Key usage attributes - Anahtar kullanım amacına göre özellikler</para>
<para>Anahtarın hangi işlemler için kullanılabileceğini belirten attribute&apos;lar eklenir:<itemizedlist>
<listitem><para>ENCRYPT_DECRYPT: CKA_ENCRYPT ve CKA_DECRYPT attribute&apos;ları</para>
</listitem><listitem><para>SIGN_VERIFY: CKA_SIGN ve CKA_VERIFY attribute&apos;ları</para>
</listitem></itemizedlist>
</para>
<para>AES için key size attribute&apos;u</para>
<para>AES anahtarları için key size (256 bit = 32 byte) belirtilir. RSA ve EC anahtarları için key size attribute&apos;u gerekmez.</para>
<para>&lt; AES anahtar uzunluğu (32 byte)</para>
<para>PKCS#11 anahtar oluşturma</para>
<para>Simetrik anahtarlar (AES) için C_GenerateKey, asimetrik anahtarlar (RSA, EC) için C_GenerateKeyPair kullanılır. Key pair generation için public key template&apos;i de oluşturulmalıdır.</para>
<para>&lt; Oluşturulan anahtar handle&apos;ı</para>
<para>&lt; PKCS#11 return code</para>
<para>Key pair generation - Public key template</para>
<para>Asimetrik anahtarlar (RSA, EC) için public key template&apos;i oluşturulur. Public key template&apos;i, key class ve key type bilgilerini içerir.</para>
<para>&lt; Public key attribute template</para>
<para>&lt; Public key template attribute sayısı</para>
<para>Key ID oluşturma</para>
<para>Oluşturulan anahtarın handle&apos;ı keyId olarak kullanılır. Eğer keyId buffer yeterli büyüklükteyse (CK_OBJECT_HANDLE boyutu), handle kopyalanır. Aksi takdirde, label&apos;den hash oluşturulur.</para>
<para>Key ID buffer yeterli: handle&apos;ı kopyala</para>
<para>Key ID buffer küçük: label&apos;den hash oluştur</para>
<para>Bu durumda, label&apos;ın ilk N karakteri keyId olarak kullanılır. N, keyId buffer boyutu ve label uzunluğunun minimum&apos;udur.</para>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="558" column="11" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="558" bodyend="755" declfile="src/travelexpense/header/softhsm.h" declline="123" declcolumn="29"/>
      </memberdef>
      <memberdef kind="function" id="namespace_travel_expense_1_1_soft_h_s_m_1af8527db38f2e8d22d54baf72e43315cf" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="export_8h_1a21d78c0dc6e2907cbb76e2b0468cceb6" kindref="member">TRAVELEXPENSE_API</ref> ErrorCode</type>
        <definition>ErrorCode TravelExpense::SoftHSM::findKey</definition>
        <argsstring>(const char *keyLabel, uint8_t *keyId, size_t &amp;keyIdLen)</argsstring>
        <name>findKey</name>
        <qualifiedname>TravelExpense::SoftHSM::findKey</qualifiedname>
        <param>
          <type>const char *</type>
          <declname>keyLabel</declname>
        </param>
        <param>
          <type>uint8_t *</type>
          <declname>keyId</declname>
        </param>
        <param>
          <type>size_t &amp;</type>
          <declname>keyIdLen</declname>
        </param>
        <briefdescription>
<para>Anahtarı bul (find key by label) </para>
        </briefdescription>
        <detaileddescription>
<para>Anahtarı label&apos;a göre bul.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>keyLabel</parametername>
</parameternamelist>
<parameterdescription>
<para>Anahtar etiketi </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>keyId</parametername>
</parameternamelist>
<parameterdescription>
<para>Çıktı: Bulunan anahtar ID&apos;si </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>keyIdLen</parametername>
</parameternamelist>
<parameterdescription>
<para>Çıktı: Anahtar ID uzunluğu </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>ErrorCode Başarı durumu</para>
</simplesect>
</para>
<para>Belirtilen label&apos;a sahip anahtarı token üzerinde arar ve keyId&apos;sini döndürür. Arama, C_FindObjectsInit ve C_FindObjects kullanılarak yapılır.</para>
<para><simplesect kind="note"><para>Bu fonksiyon, açık bir session gerektirir (<ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a1dd53afa782d6054163658a225a3e3bf" kindref="member">openToken()</ref> çağrılmış olmalı). Anahtar bulunamazsa FileNotFound döner.</para>
</simplesect>
<parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>keyLabel</parametername>
</parameternamelist>
<parameterdescription>
<para>Anahtar etiketi (nullptr ise InvalidInput döner) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>keyId</parametername>
</parameternamelist>
<parameterdescription>
<para>Bulunan anahtarın ID&apos;si (çıktı, nullptr ise InvalidInput döner) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>keyIdLen</parametername>
</parameternamelist>
<parameterdescription>
<para>keyId buffer boyutu (giriş), bulunan ID boyutu (çıktı) </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>ErrorCode Başarı durumu (Success, FileNotFound, InvalidInput) </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="771" column="11" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="771" bodyend="813" declfile="src/travelexpense/header/softhsm.h" declline="148" declcolumn="29"/>
      </memberdef>
      <memberdef kind="function" id="namespace_travel_expense_1_1_soft_h_s_m_1aa4b7ad5db79291a92b339855944a4208" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="export_8h_1a21d78c0dc6e2907cbb76e2b0468cceb6" kindref="member">TRAVELEXPENSE_API</ref> ErrorCode</type>
        <definition>ErrorCode TravelExpense::SoftHSM::deleteKey</definition>
        <argsstring>(const uint8_t *keyId, size_t keyIdLen)</argsstring>
        <name>deleteKey</name>
        <qualifiedname>TravelExpense::SoftHSM::deleteKey</qualifiedname>
        <param>
          <type>const uint8_t *</type>
          <declname>keyId</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>keyIdLen</declname>
        </param>
        <briefdescription>
<para>Anahtarı sil. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>keyId</parametername>
</parameternamelist>
<parameterdescription>
<para>Anahtar ID&apos;si </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>keyIdLen</parametername>
</parameternamelist>
<parameterdescription>
<para>Anahtar ID uzunluğu </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>ErrorCode Başarı durumu</para>
</simplesect>
</para>
<para>Belirtilen keyId&apos;ye sahip anahtarı token üzerinden siler. C_DestroyObject kullanılarak anahtar kalıcı olarak silinir.</para>
<para><simplesect kind="note"><para>Bu fonksiyon, açık bir session gerektirir (<ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a1dd53afa782d6054163658a225a3e3bf" kindref="member">openToken()</ref> çağrılmış olmalı). Anahtar silindikten sonra geri getirilemez.</para>
</simplesect>
<parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>keyId</parametername>
</parameternamelist>
<parameterdescription>
<para>Silinecek anahtarın ID&apos;si (nullptr ise InvalidInput döner) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>keyIdLen</parametername>
</parameternamelist>
<parameterdescription>
<para>keyId buffer boyutu (CK_OBJECT_HANDLE boyutu olmalı) </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>ErrorCode Başarı durumu </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="828" column="11" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="828" bodyend="843" declfile="src/travelexpense/header/softhsm.h" declline="157" declcolumn="29"/>
      </memberdef>
      <memberdef kind="function" id="namespace_travel_expense_1_1_soft_h_s_m_1aa76da1d2f45b48a32039219d89930d6b" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="export_8h_1a21d78c0dc6e2907cbb76e2b0468cceb6" kindref="member">TRAVELEXPENSE_API</ref> ErrorCode</type>
        <definition>ErrorCode TravelExpense::SoftHSM::encrypt</definition>
        <argsstring>(const uint8_t *keyId, size_t keyIdLen, const void *plaintext, size_t plaintextLen, void *ciphertext, size_t &amp;ciphertextLen, uint8_t *iv=nullptr)</argsstring>
        <name>encrypt</name>
        <qualifiedname>TravelExpense::SoftHSM::encrypt</qualifiedname>
        <param>
          <type>const uint8_t *</type>
          <declname>keyId</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>keyIdLen</declname>
        </param>
        <param>
          <type>const void *</type>
          <declname>plaintext</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>plaintextLen</declname>
        </param>
        <param>
          <type>void *</type>
          <declname>ciphertext</declname>
        </param>
        <param>
          <type>size_t &amp;</type>
          <declname>ciphertextLen</declname>
        </param>
        <param>
          <type>uint8_t *</type>
          <declname>iv</declname>
          <defval>nullptr</defval>
        </param>
        <briefdescription>
<para>Veriyi şifrele (encrypt using HSM key) </para>
        </briefdescription>
        <detaileddescription>
<para>Veriyi şifrele (AES-CBC)</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>keyId</parametername>
</parameternamelist>
<parameterdescription>
<para>Anahtar ID&apos;si </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>keyIdLen</parametername>
</parameternamelist>
<parameterdescription>
<para>Anahtar ID uzunluğu </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>plaintext</parametername>
</parameternamelist>
<parameterdescription>
<para>Şifrelenecek veri </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>plaintextLen</parametername>
</parameternamelist>
<parameterdescription>
<para>Veri uzunluğu </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>ciphertext</parametername>
</parameternamelist>
<parameterdescription>
<para>Şifrelenmiş veri çıktısı </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>ciphertextLen</parametername>
</parameternamelist>
<parameterdescription>
<para>Şifrelenmiş veri uzunluğu (çıktı) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>iv</parametername>
</parameternamelist>
<parameterdescription>
<para>IV çıktısı (nullptr ise otomatik oluşturulur) </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>ErrorCode Başarı durumu</para>
</simplesect>
</para>
<para>Belirtilen anahtar ile veriyi AES-CBC modunda şifreler. IV (Initialization Vector) belirtilmemişse, PKCS#11&apos;nin rastgele sayı üreticisi ile oluşturulur.</para>
<para><simplesect kind="note"><para>Bu fonksiyon, açık bir session gerektirir (<ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a1dd53afa782d6054163658a225a3e3bf" kindref="member">openToken()</ref> çağrılmış olmalı). AES-CBC-PAD mekanizması kullanılır, bu nedenle padding otomatik olarak eklenir. Ciphertext boyutu, plaintext boyutundan büyük olabilir.</para>
</simplesect>
<parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>keyId</parametername>
</parameternamelist>
<parameterdescription>
<para>Şifreleme anahtarının ID&apos;si (nullptr ise InvalidInput döner) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>keyIdLen</parametername>
</parameternamelist>
<parameterdescription>
<para>keyId buffer boyutu </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>plaintext</parametername>
</parameternamelist>
<parameterdescription>
<para>Şifrelenecek veri (nullptr ise InvalidInput döner) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>plaintextLen</parametername>
</parameternamelist>
<parameterdescription>
<para>Veri uzunluğu (byte, 0 ise InvalidInput döner) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>ciphertext</parametername>
</parameternamelist>
<parameterdescription>
<para>Şifrelenmiş veri çıktısı (nullptr ise InvalidInput döner) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>ciphertextLen</parametername>
</parameternamelist>
<parameterdescription>
<para>ciphertext buffer boyutu (giriş), şifrelenmiş veri boyutu (çıktı) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>iv</parametername>
</parameternamelist>
<parameterdescription>
<para>Initialization Vector (nullptr ise otomatik oluşturulur) </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>ErrorCode Başarı durumu </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
<para>IV (Initialization Vector) oluşturma</para>
<para>Eğer IV verilmemişse, PKCS#11&apos;nin rastgele sayı üreticisi ile 16 byte (128 bit) IV oluşturulur. IV, AES-CBC modunda her şifreleme işlemi için benzersiz olmalıdır.</para>
<para>&lt; Local IV buffer (16 byte = AES block size)</para>
<para>IV verilmemiş: PKCS#11 ile rastgele IV oluştur</para>
<para>AES-CBC mekanizması ayarlama</para>
<para>CKM_AES_CBC_PAD mekanizması kullanılır. Bu mekanizma, PKCS7 padding otomatik olarak ekler ve kaldırır. IV, mechanism parametresi olarak belirtilir (16 byte).</para>
<para>&lt; AES-CBC modu + PKCS7 padding</para>
<para>&lt; IV (16 byte)</para>
<para>&lt; IV uzunluğu (16 byte)</para>
<para>IV (Initialization Vector) oluşturma</para>
<para>Eğer IV verilmemişse, PKCS#11&apos;nin rastgele sayı üreticisi ile 16 byte (128 bit) IV oluşturulur. IV, AES-CBC modunda her şifreleme işlemi için benzersiz olmalıdır.</para>
<para>&lt; Local IV buffer (16 byte = AES block size)</para>
<para>IV verilmemiş: PKCS#11 ile rastgele IV oluştur</para>
<para>AES-CBC mekanizması ayarlama</para>
<para>CKM_AES_CBC_PAD mekanizması kullanılır. Bu mekanizma, PKCS7 padding otomatik olarak ekler ve kaldırır. IV, mechanism parametresi olarak belirtilir (16 byte).</para>
<para>&lt; AES-CBC modu + PKCS7 padding</para>
<para>&lt; IV (16 byte)</para>
<para>&lt; IV uzunluğu (16 byte)</para>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="865" column="11" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="865" bodyend="935" declfile="src/travelexpense/header/softhsm.h" declline="171" declcolumn="29"/>
      </memberdef>
      <memberdef kind="function" id="namespace_travel_expense_1_1_soft_h_s_m_1af50d97c17003e1b54df285fbf5fa76b9" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="export_8h_1a21d78c0dc6e2907cbb76e2b0468cceb6" kindref="member">TRAVELEXPENSE_API</ref> ErrorCode</type>
        <definition>ErrorCode TravelExpense::SoftHSM::decrypt</definition>
        <argsstring>(const uint8_t *keyId, size_t keyIdLen, const void *ciphertext, size_t ciphertextLen, void *plaintext, size_t &amp;plaintextLen, const uint8_t *iv=nullptr)</argsstring>
        <name>decrypt</name>
        <qualifiedname>TravelExpense::SoftHSM::decrypt</qualifiedname>
        <param>
          <type>const uint8_t *</type>
          <declname>keyId</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>keyIdLen</declname>
        </param>
        <param>
          <type>const void *</type>
          <declname>ciphertext</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>ciphertextLen</declname>
        </param>
        <param>
          <type>void *</type>
          <declname>plaintext</declname>
        </param>
        <param>
          <type>size_t &amp;</type>
          <declname>plaintextLen</declname>
        </param>
        <param>
          <type>const uint8_t *</type>
          <declname>iv</declname>
          <defval>nullptr</defval>
        </param>
        <briefdescription>
<para>Veriyi şifre çöz (decrypt using HSM key) </para>
        </briefdescription>
        <detaileddescription>
<para>Şifrelenmiş veriyi çöz (AES-CBC)</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>keyId</parametername>
</parameternamelist>
<parameterdescription>
<para>Anahtar ID&apos;si </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>keyIdLen</parametername>
</parameternamelist>
<parameterdescription>
<para>Anahtar ID uzunluğu </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>ciphertext</parametername>
</parameternamelist>
<parameterdescription>
<para>Şifrelenmiş veri </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>ciphertextLen</parametername>
</parameternamelist>
<parameterdescription>
<para>Şifrelenmiş veri uzunluğu </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>plaintext</parametername>
</parameternamelist>
<parameterdescription>
<para>Şifre çözülmüş veri çıktısı </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>plaintextLen</parametername>
</parameternamelist>
<parameterdescription>
<para>Şifre çözülmüş veri uzunluğu (çıktı) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>iv</parametername>
</parameternamelist>
<parameterdescription>
<para>IV (nullptr ise ciphertext&apos;in başından okunur) </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>ErrorCode Başarı durumu</para>
</simplesect>
</para>
<para>Belirtilen anahtar ile şifrelenmiş veriyi AES-CBC modunda çözer. IV (Initialization Vector) belirtilmemişse, ciphertext&apos;in ilk 16 byte&apos;ı IV olarak kullanılır.</para>
<para><simplesect kind="note"><para>Bu fonksiyon, açık bir session gerektirir (<ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a1dd53afa782d6054163658a225a3e3bf" kindref="member">openToken()</ref> çağrılmış olmalı). AES-CBC-PAD mekanizması kullanılır, bu nedenle padding otomatik olarak kaldırılır. Plaintext boyutu, ciphertext boyutundan küçük veya eşit olabilir.</para>
</simplesect>
<parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>keyId</parametername>
</parameternamelist>
<parameterdescription>
<para>Şifre çözme anahtarının ID&apos;si (nullptr ise InvalidInput döner) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>keyIdLen</parametername>
</parameternamelist>
<parameterdescription>
<para>keyId buffer boyutu </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>ciphertext</parametername>
</parameternamelist>
<parameterdescription>
<para>Şifrelenmiş veri (nullptr ise InvalidInput döner) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>ciphertextLen</parametername>
</parameternamelist>
<parameterdescription>
<para>Şifrelenmiş veri uzunluğu (byte, 0 ise InvalidInput döner) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>plaintext</parametername>
</parameternamelist>
<parameterdescription>
<para>Çözülmüş veri çıktısı (nullptr ise InvalidInput döner) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>plaintextLen</parametername>
</parameternamelist>
<parameterdescription>
<para>plaintext buffer boyutu (giriş), çözülmüş veri boyutu (çıktı) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>iv</parametername>
</parameternamelist>
<parameterdescription>
<para>Initialization Vector (nullptr ise ciphertext&apos;in ilk 16 byte&apos;ı kullanılır) </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>ErrorCode Başarı durumu </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
<para>IV (Initialization Vector) alma</para>
<para>Eğer IV verilmemişse, ciphertext&apos;in ilk 16 byte&apos;ı IV olarak kullanılır. Bu, yaygın bir uygulama pratiğidir (IV + ciphertext formatı). Eğer IV verilmemiş ve ciphertext 16 byte&apos;dan küçükse, hata döner.</para>
<para>&lt; Local IV buffer (16 byte = AES block size)</para>
<para>IV verilmemiş ve ciphertext yeterli uzunlukta: Ciphertext&apos;in ilk 16 byte&apos;ı IV olarak kullanılır.</para>
<para>IV verilmemiş ve ciphertext yeterli uzunlukta değil: hata</para>
<para>AES-CBC mekanizması ayarlama</para>
<para>CKM_AES_CBC_PAD mekanizması kullanılır. Bu mekanizma, PKCS7 padding otomatik olarak kaldırır. IV, mechanism parametresi olarak belirtilir (16 byte).</para>
<para>&lt; AES-CBC modu + PKCS7 padding</para>
<para>&lt; IV (16 byte)</para>
<para>&lt; IV uzunluğu (16 byte)</para>
<para>IV (Initialization Vector) alma</para>
<para>Eğer IV verilmemişse, ciphertext&apos;in ilk 16 byte&apos;ı IV olarak kullanılır. Bu, yaygın bir uygulama pratiğidir (IV + ciphertext formatı). Eğer IV verilmemiş ve ciphertext 16 byte&apos;dan küçükse, hata döner.</para>
<para>&lt; Local IV buffer (16 byte = AES block size)</para>
<para>IV verilmemiş ve ciphertext yeterli uzunlukta: Ciphertext&apos;in ilk 16 byte&apos;ı IV olarak kullanılır.</para>
<para>IV verilmemiş ve ciphertext yeterli uzunlukta değil: hata</para>
<para>AES-CBC mekanizması ayarlama</para>
<para>CKM_AES_CBC_PAD mekanizması kullanılır. Bu mekanizma, PKCS7 padding otomatik olarak kaldırır. IV, mechanism parametresi olarak belirtilir (16 byte).</para>
<para>&lt; AES-CBC modu + PKCS7 padding</para>
<para>&lt; IV (16 byte)</para>
<para>&lt; IV uzunluğu (16 byte)</para>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="957" column="11" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="957" bodyend="1029" declfile="src/travelexpense/header/softhsm.h" declline="188" declcolumn="29"/>
      </memberdef>
      <memberdef kind="function" id="namespace_travel_expense_1_1_soft_h_s_m_1ac14ac62bb1ee91f10908af2ba8f7a832" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="export_8h_1a21d78c0dc6e2907cbb76e2b0468cceb6" kindref="member">TRAVELEXPENSE_API</ref> ErrorCode</type>
        <definition>ErrorCode TravelExpense::SoftHSM::sign</definition>
        <argsstring>(const uint8_t *keyId, size_t keyIdLen, const void *data, size_t dataLen, void *signature, size_t &amp;signatureLen)</argsstring>
        <name>sign</name>
        <qualifiedname>TravelExpense::SoftHSM::sign</qualifiedname>
        <param>
          <type>const uint8_t *</type>
          <declname>keyId</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>keyIdLen</declname>
        </param>
        <param>
          <type>const void *</type>
          <declname>data</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>dataLen</declname>
        </param>
        <param>
          <type>void *</type>
          <declname>signature</declname>
        </param>
        <param>
          <type>size_t &amp;</type>
          <declname>signatureLen</declname>
        </param>
        <briefdescription>
<para>Veriyi imzala (sign data) </para>
        </briefdescription>
        <detaileddescription>
<para>Veriyi imzala (SHA256-RSA-PKCS)</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>keyId</parametername>
</parameternamelist>
<parameterdescription>
<para>Anahtar ID&apos;si </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>keyIdLen</parametername>
</parameternamelist>
<parameterdescription>
<para>Anahtar ID uzunluğu </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>data</parametername>
</parameternamelist>
<parameterdescription>
<para>İmzalanacak veri </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>dataLen</parametername>
</parameternamelist>
<parameterdescription>
<para>Veri uzunluğu </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>signature</parametername>
</parameternamelist>
<parameterdescription>
<para>İmza çıktısı </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>signatureLen</parametername>
</parameternamelist>
<parameterdescription>
<para>İmza uzunluğu (çıktı) </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>ErrorCode Başarı durumu</para>
</simplesect>
</para>
<para>Belirtilen anahtar ile veriyi SHA256 hash&apos;leyip RSA-PKCS imzası oluşturur. SHA256-RSA-PKCS mekanizması kullanılır.</para>
<para><simplesect kind="note"><para>Bu fonksiyon, açık bir session gerektirir (<ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a1dd53afa782d6054163658a225a3e3bf" kindref="member">openToken()</ref> çağrılmış olmalı). Veri önce SHA256 ile hash&apos;lenir, sonra RSA ile imzalanır. Signature boyutu, RSA anahtar boyutuna bağlıdır (2048-bit için 256 byte).</para>
</simplesect>
<parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>keyId</parametername>
</parameternamelist>
<parameterdescription>
<para>İmzalama anahtarının ID&apos;si (nullptr ise InvalidInput döner) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>keyIdLen</parametername>
</parameternamelist>
<parameterdescription>
<para>keyId buffer boyutu </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>data</parametername>
</parameternamelist>
<parameterdescription>
<para>İmzalanacak veri (nullptr ise InvalidInput döner) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>dataLen</parametername>
</parameternamelist>
<parameterdescription>
<para>Veri uzunluğu (byte, 0 ise InvalidInput döner) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>signature</parametername>
</parameternamelist>
<parameterdescription>
<para>İmza çıktısı (nullptr ise InvalidInput döner) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>signatureLen</parametername>
</parameternamelist>
<parameterdescription>
<para>signature buffer boyutu (giriş), imza boyutu (çıktı) </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>ErrorCode Başarı durumu </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
<para>SHA256-RSA-PKCS mekanizması ayarlama</para>
<para>CKM_SHA256_RSA_PKCS mekanizması kullanılır. Bu mekanizma, veriyi önce SHA-256 ile hash&apos;ler, sonra RSA-PKCS ile imzalar. Parametre gerektirmez.</para>
<para>&lt; SHA-256 hash + RSA-PKCS imzalama</para>
<para>&lt; Parametre gerekmez</para>
<para>&lt; Parametre uzunluğu 0</para>
<para>İmzalama işlemini başlatma</para>
<para>C_SignInit ile imzalama mekanizması ve anahtar ayarlanır. Bu işlem, sonraki C_Sign çağrısı için hazırlık yapar.</para>
<para>Veriyi imzalama</para>
<para>C_Sign ile veri imzalanır. Veri önce SHA-256 ile hash&apos;lenir, sonra RSA-PKCS ile imzalanır. İmza boyutu, RSA anahtar boyutuna bağlıdır (2048-bit için 256 byte).</para>
<para>&lt; İmza buffer boyutu (giriş), gerçek imza boyutu (çıktı)</para>
<para>SHA256-RSA-PKCS mekanizması ayarlama</para>
<para>CKM_SHA256_RSA_PKCS mekanizması kullanılır. Bu mekanizma, veriyi önce SHA-256 ile hash&apos;ler, sonra RSA-PKCS ile imzalar. Parametre gerektirmez.</para>
<para>&lt; SHA-256 hash + RSA-PKCS imzalama</para>
<para>&lt; Parametre gerekmez</para>
<para>&lt; Parametre uzunluğu 0</para>
<para>İmzalama işlemini başlatma</para>
<para>C_SignInit ile imzalama mekanizması ve anahtar ayarlanır. Bu işlem, sonraki C_Sign çağrısı için hazırlık yapar.</para>
<para>Veriyi imzalama</para>
<para>C_Sign ile veri imzalanır. Veri önce SHA-256 ile hash&apos;lenir, sonra RSA-PKCS ile imzalanır. İmza boyutu, RSA anahtar boyutuna bağlıdır (2048-bit için 256 byte).</para>
<para>&lt; İmza buffer boyutu (giriş), gerçek imza boyutu (çıktı)</para>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="1049" column="11" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="1049" bodyend="1109" declfile="src/travelexpense/header/softhsm.h" declline="204" declcolumn="29"/>
      </memberdef>
      <memberdef kind="function" id="namespace_travel_expense_1_1_soft_h_s_m_1a6e1b43ac34b60670eafe4cb1c347335a" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="export_8h_1a21d78c0dc6e2907cbb76e2b0468cceb6" kindref="member">TRAVELEXPENSE_API</ref> bool</type>
        <definition>bool TravelExpense::SoftHSM::verify</definition>
        <argsstring>(const uint8_t *keyId, size_t keyIdLen, const void *data, size_t dataLen, const void *signature, size_t signatureLen)</argsstring>
        <name>verify</name>
        <qualifiedname>TravelExpense::SoftHSM::verify</qualifiedname>
        <param>
          <type>const uint8_t *</type>
          <declname>keyId</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>keyIdLen</declname>
        </param>
        <param>
          <type>const void *</type>
          <declname>data</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>dataLen</declname>
        </param>
        <param>
          <type>const void *</type>
          <declname>signature</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>signatureLen</declname>
        </param>
        <briefdescription>
<para>İmzayı doğrula (verify signature) </para>
        </briefdescription>
        <detaileddescription>
<para>İmzayı doğrula (SHA256-RSA-PKCS)</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>keyId</parametername>
</parameternamelist>
<parameterdescription>
<para>Anahtar ID&apos;si </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>keyIdLen</parametername>
</parameternamelist>
<parameterdescription>
<para>Anahtar ID uzunluğu </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>data</parametername>
</parameternamelist>
<parameterdescription>
<para>İmzalanmış veri </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>dataLen</parametername>
</parameternamelist>
<parameterdescription>
<para>Veri uzunluğu </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>signature</parametername>
</parameternamelist>
<parameterdescription>
<para>İmza </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>signatureLen</parametername>
</parameternamelist>
<parameterdescription>
<para>İmza uzunluğu </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>true İmza geçerli, false Geçersiz</para>
</simplesect>
</para>
<para>Belirtilen anahtar ile veriyi SHA256 hash&apos;leyip RSA-PKCS imzasını doğrular. SHA256-RSA-PKCS mekanizması kullanılır.</para>
<para><simplesect kind="note"><para>Bu fonksiyon, açık bir session gerektirir (<ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a1dd53afa782d6054163658a225a3e3bf" kindref="member">openToken()</ref> çağrılmış olmalı). Veri önce SHA256 ile hash&apos;lenir, sonra RSA ile imza doğrulanır.</para>
</simplesect>
<parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>keyId</parametername>
</parameternamelist>
<parameterdescription>
<para>Doğrulama anahtarının ID&apos;si (nullptr ise false döner) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>keyIdLen</parametername>
</parameternamelist>
<parameterdescription>
<para>keyId buffer boyutu </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>data</parametername>
</parameternamelist>
<parameterdescription>
<para>Doğrulanacak veri (nullptr ise false döner) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>dataLen</parametername>
</parameternamelist>
<parameterdescription>
<para>Veri uzunluğu (byte, 0 ise false döner) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>signature</parametername>
</parameternamelist>
<parameterdescription>
<para>İmza (nullptr ise false döner) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>signatureLen</parametername>
</parameternamelist>
<parameterdescription>
<para>İmza uzunluğu (byte, 0 ise false döner) </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>true İmza geçerli, false İmza geçersiz veya hata </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
<para>SHA256-RSA-PKCS mekanizması ayarlama</para>
<para>CKM_SHA256_RSA_PKCS mekanizması kullanılır. Bu mekanizma, veriyi önce SHA-256 ile hash&apos;ler, sonra RSA-PKCS ile imza doğrular. Parametre gerektirmez.</para>
<para>&lt; SHA-256 hash + RSA-PKCS imza doğrulama</para>
<para>&lt; Parametre gerekmez</para>
<para>&lt; Parametre uzunluğu 0</para>
<para>İmza doğrulama işlemini başlatma</para>
<para>C_VerifyInit ile imza doğrulama mekanizması ve anahtar ayarlanır. Bu işlem, sonraki C_Verify çağrısı için hazırlık yapar.</para>
<para>İmzayı doğrulama</para>
<para>C_Verify ile imza doğrulanır. Veri önce SHA-256 ile hash&apos;lenir, sonra RSA-PKCS ile imza doğrulanır. İmza geçerliyse CKR_OK döner.</para>
<para>&lt; true = imza geçerli, false = imza geçersiz veya hata</para>
<para>SHA256-RSA-PKCS mekanizması ayarlama</para>
<para>CKM_SHA256_RSA_PKCS mekanizması kullanılır. Bu mekanizma, veriyi önce SHA-256 ile hash&apos;ler, sonra RSA-PKCS ile imza doğrular. Parametre gerektirmez.</para>
<para>&lt; SHA-256 hash + RSA-PKCS imza doğrulama</para>
<para>&lt; Parametre gerekmez</para>
<para>&lt; Parametre uzunluğu 0</para>
<para>İmza doğrulama işlemini başlatma</para>
<para>C_VerifyInit ile imza doğrulama mekanizması ve anahtar ayarlanır. Bu işlem, sonraki C_Verify çağrısı için hazırlık yapar.</para>
<para>İmzayı doğrulama</para>
<para>C_Verify ile imza doğrulanır. Veri önce SHA-256 ile hash&apos;lenir, sonra RSA-PKCS ile imza doğrulanır. İmza geçerliyse CKR_OK döner.</para>
<para>&lt; true = imza geçerli, false = imza geçersiz veya hata</para>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="1128" column="6" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="1128" bodyend="1180" declfile="src/travelexpense/header/softhsm.h" declline="219" declcolumn="24"/>
      </memberdef>
      <memberdef kind="function" id="namespace_travel_expense_1_1_soft_h_s_m_1ac132d386ec4642b70cbfc87db1dd84f3" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="export_8h_1a21d78c0dc6e2907cbb76e2b0468cceb6" kindref="member">TRAVELEXPENSE_API</ref> ErrorCode</type>
        <definition>ErrorCode TravelExpense::SoftHSM::generateRandom</definition>
        <argsstring>(uint8_t *output, size_t length)</argsstring>
        <name>generateRandom</name>
        <qualifiedname>TravelExpense::SoftHSM::generateRandom</qualifiedname>
        <param>
          <type>uint8_t *</type>
          <declname>output</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>length</declname>
        </param>
        <briefdescription>
<para>Rastgele veri üret (HSM&apos;den güvenli random) </para>
        </briefdescription>
        <detaileddescription>
<para>Kriptografik olarak güvenli rastgele veri üret.</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>output</parametername>
</parameternamelist>
<parameterdescription>
<para>Rastgele veri çıktısı </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>length</parametername>
</parameternamelist>
<parameterdescription>
<para>İstenen uzunluk (byte) </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>ErrorCode Başarı durumu</para>
</simplesect>
</para>
<para>PKCS#11&apos;nin rastgele sayı üreticisini kullanarak kriptografik olarak güvenli rastgele veri üretir. C_GenerateRandom fonksiyonu kullanılır.</para>
<para><simplesect kind="note"><para>Bu fonksiyon, açık bir session gerektirir (<ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a1dd53afa782d6054163658a225a3e3bf" kindref="member">openToken()</ref> çağrılmış olmalı). Üretilen rastgele veriler, kriptografik işlemler için uygundur (IV, salt, vb.).</para>
</simplesect>
<parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>output</parametername>
</parameternamelist>
<parameterdescription>
<para>Rastgele veri çıktısı (nullptr ise InvalidInput döner) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>length</parametername>
</parameternamelist>
<parameterdescription>
<para>Üretilecek veri uzunluğu (byte, 0 ise InvalidInput döner) </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>ErrorCode Başarı durumu </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="1195" column="11" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="1195" bodyend="1203" declfile="src/travelexpense/header/softhsm.h" declline="230" declcolumn="29"/>
      </memberdef>
      <memberdef kind="function" id="namespace_travel_expense_1_1_soft_h_s_m_1a627d80f41250c6562b1cd91521787245" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="export_8h_1a21d78c0dc6e2907cbb76e2b0468cceb6" kindref="member">TRAVELEXPENSE_API</ref> ErrorCode</type>
        <definition>ErrorCode TravelExpense::SoftHSM::listTokens</definition>
        <argsstring>(char labels[][64], size_t &amp;count)</argsstring>
        <name>listTokens</name>
        <qualifiedname>TravelExpense::SoftHSM::listTokens</qualifiedname>
        <param>
          <type>char</type>
          <declname>labels</declname>
          <array>[][64]</array>
        </param>
        <param>
          <type>size_t &amp;</type>
          <declname>count</declname>
        </param>
        <briefdescription>
<para>Mevcut token&apos;ları listele. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>labels</parametername>
</parameternamelist>
<parameterdescription>
<para>Çıktı: Token etiketleri dizisi (max 10 token) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>count</parametername>
</parameternamelist>
<parameterdescription>
<para>Çıktı: Bulunan token sayısı </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>ErrorCode Başarı durumu</para>
</simplesect>
</para>
<para>Sistemde mevcut tüm token&apos;ların label&apos;larını listeler. C_GetSlotList ve C_GetTokenInfo kullanılarak token bilgileri alınır.</para>
<para><simplesect kind="note"><para>Bu fonksiyon, <ref refid="namespace_travel_expense_1_1_soft_h_s_m" kindref="compound">SoftHSM</ref>&apos;nin INITIALIZED durumunda olmasını gerektirir. Maksimum 10 token listelenir. Token label&apos;ları, boşluklarla doldurulmuş olabilir, bu nedenle son boşluklar temizlenir.</para>
</simplesect>
<parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>labels</parametername>
</parameternamelist>
<parameterdescription>
<para>Token label&apos;ları dizisi (nullptr ise InvalidInput döner) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>count</parametername>
</parameternamelist>
<parameterdescription>
<para>labels dizisi boyutu (giriş), bulunan token sayısı (çıktı) </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>ErrorCode Başarı durumu </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
<para>Token label&apos;larını toplama</para>
<para>Her slot&apos;taki token&apos;ın label&apos;ı alınır ve listeye eklenir. Maksimum 10 token listelenir (performans için sınır). Token label&apos;ları PKCS#11&apos;de boşluklarla doldurulmuş olabilir, bu nedenle son boşluklar temizlenir.</para>
<para>&lt; Bulunan token sayısı</para>
<para>&lt; Token bilgisi</para>
<para>Token bulundu: Label&apos;i kopyala ve boşlukları temizle</para>
<para>PKCS#11 token label&apos;ları 32 byte uzunluğunda ve null-terminated değildir. Boşluklarla doldurulmuş olabilir, bu nedenle son boşluklar temizlenir.</para>
<para>Token label&apos;larını toplama</para>
<para>Her slot&apos;taki token&apos;ın label&apos;ı alınır ve listeye eklenir. Maksimum 10 token listelenir (performans için sınır). Token label&apos;ları PKCS#11&apos;de boşluklarla doldurulmuş olabilir, bu nedenle son boşluklar temizlenir.</para>
<para>&lt; Bulunan token sayısı</para>
<para>&lt; Token bilgisi</para>
<para>Token bulundu: Label&apos;i kopyala ve boşlukları temizle</para>
<para>PKCS#11 token label&apos;ları 32 byte uzunluğunda ve null-terminated değildir. Boşluklarla doldurulmuş olabilir, bu nedenle son boşluklar temizlenir.</para>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="1219" column="11" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="1219" bodyend="1276" declfile="src/travelexpense/header/softhsm.h" declline="239" declcolumn="29"/>
      </memberdef>
      <memberdef kind="function" id="namespace_travel_expense_1_1_soft_h_s_m_1ae037de28b34ae8a110a65f222e52ac06" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="export_8h_1a21d78c0dc6e2907cbb76e2b0468cceb6" kindref="member">TRAVELEXPENSE_API</ref> ErrorCode</type>
        <definition>ErrorCode TravelExpense::SoftHSM::listKeys</definition>
        <argsstring>(char labels[][64], size_t &amp;count)</argsstring>
        <name>listKeys</name>
        <qualifiedname>TravelExpense::SoftHSM::listKeys</qualifiedname>
        <param>
          <type>char</type>
          <declname>labels</declname>
          <array>[][64]</array>
        </param>
        <param>
          <type>size_t &amp;</type>
          <declname>count</declname>
        </param>
        <briefdescription>
<para>Mevcut anahtarları listele. </para>
        </briefdescription>
        <detaileddescription>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>labels</parametername>
</parameternamelist>
<parameterdescription>
<para>Çıktı: Anahtar etiketleri dizisi (max 50 key) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>count</parametername>
</parameternamelist>
<parameterdescription>
<para>Çıktı: Bulunan anahtar sayısı </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>ErrorCode Başarı durumu</para>
</simplesect>
</para>
<para>Token üzerinde mevcut tüm secret key&apos;lerin label&apos;larını listeler. C_FindObjectsInit, C_FindObjects ve C_GetAttributeValue kullanılarak anahtar bilgileri alınır.</para>
<para><simplesect kind="note"><para>Bu fonksiyon, açık bir session gerektirir (<ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a1dd53afa782d6054163658a225a3e3bf" kindref="member">openToken()</ref> çağrılmış olmalı). Maksimum 50 anahtar listelenir. Sadece secret key&apos;ler listelenir.</para>
</simplesect>
<parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>labels</parametername>
</parameternamelist>
<parameterdescription>
<para>Anahtar label&apos;ları dizisi (nullptr ise InvalidInput döner) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>count</parametername>
</parameternamelist>
<parameterdescription>
<para>labels dizisi boyutu (giriş), bulunan anahtar sayısı (çıktı) </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>ErrorCode Başarı durumu </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
<para>Anahtar label&apos;larını toplama</para>
<para>Token üzerindeki tüm secret key&apos;lerin label&apos;ları alınır ve listeye eklenir. Maksimum 50 anahtar listelenir (performans için sınır). Her anahtar için C_GetAttributeValue ile label attribute&apos;u alınır.</para>
<para>&lt; Bulunan anahtar sayısı</para>
<para>&lt; Maksimum listelenecek anahtar sayısı</para>
<para>Anahtar bulma ve label alma döngüsü</para>
<para>C_FindObjects ile her iterasyonda bir anahtar bulunur. Her anahtar için C_GetAttributeValue ile label attribute&apos;u alınır. Label bulunursa, listeye eklenir.</para>
<para>&lt; Bulunan anahtar handle&apos;ı</para>
<para>&lt; Bulunan obje sayısı</para>
<para>Anahtar bulunamadı: döngüden çık</para>
<para>Label attribute&apos;unu alma</para>
<para>C_GetAttributeValue ile anahtarın CKA_LABEL attribute&apos;u alınır. Label, 64 karakter buffer&apos;a yazılır ve null-terminated olarak ayarlanır.</para>
<para>&lt; Label attribute tipi</para>
<para>&lt; Label buffer (64 karakter)</para>
<para>&lt; Buffer boyutu - 1 (null terminator için)</para>
<para>Label başarıyla alındı: listeye ekle</para>
<para>&lt; Null terminator garanti</para>
<para>Anahtar label&apos;larını toplama</para>
<para>Token üzerindeki tüm secret key&apos;lerin label&apos;ları alınır ve listeye eklenir. Maksimum 50 anahtar listelenir (performans için sınır). Her anahtar için C_GetAttributeValue ile label attribute&apos;u alınır.</para>
<para>&lt; Bulunan anahtar sayısı</para>
<para>&lt; Maksimum listelenecek anahtar sayısı</para>
<para>Anahtar bulma ve label alma döngüsü</para>
<para>C_FindObjects ile her iterasyonda bir anahtar bulunur. Her anahtar için C_GetAttributeValue ile label attribute&apos;u alınır. Label bulunursa, listeye eklenir.</para>
<para>&lt; Bulunan anahtar handle&apos;ı</para>
<para>&lt; Bulunan obje sayısı</para>
<para>Anahtar bulunamadı: döngüden çık</para>
<para>Label attribute&apos;unu alma</para>
<para>C_GetAttributeValue ile anahtarın CKA_LABEL attribute&apos;u alınır. Label, 64 karakter buffer&apos;a yazılır ve null-terminated olarak ayarlanır.</para>
<para>&lt; Label attribute tipi</para>
<para>&lt; Label buffer (64 karakter)</para>
<para>&lt; Buffer boyutu - 1 (null terminator için)</para>
<para>Label başarıyla alındı: listeye ekle</para>
<para>&lt; Null terminator garanti</para>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="1292" column="11" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="1292" bodyend="1362" declfile="src/travelexpense/header/softhsm.h" declline="248" declcolumn="29"/>
      </memberdef>
      <memberdef kind="function" id="namespace_travel_expense_1_1_soft_h_s_m_1a04b9cc48d95cd483ab84818c43ed967d" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type><ref refid="export_8h_1a21d78c0dc6e2907cbb76e2b0468cceb6" kindref="member">TRAVELEXPENSE_API</ref> ErrorCode</type>
        <definition>ErrorCode TravelExpense::SoftHSM::importKey</definition>
        <argsstring>(KeyType keyType, const uint8_t *keyData, size_t keyDataLen, const char *keyLabel, uint8_t *keyId, size_t &amp;keyIdLen)</argsstring>
        <name>importKey</name>
        <qualifiedname>TravelExpense::SoftHSM::importKey</qualifiedname>
        <param>
          <type>KeyType</type>
          <declname>keyType</declname>
        </param>
        <param>
          <type>const uint8_t *</type>
          <declname>keyData</declname>
        </param>
        <param>
          <type>size_t</type>
          <declname>keyDataLen</declname>
        </param>
        <param>
          <type>const char *</type>
          <declname>keyLabel</declname>
        </param>
        <param>
          <type>uint8_t *</type>
          <declname>keyId</declname>
        </param>
        <param>
          <type>size_t &amp;</type>
          <declname>keyIdLen</declname>
        </param>
        <briefdescription>
<para>Anahtarı içe aktar (import key) </para>
        </briefdescription>
        <detaileddescription>
<para>Anahtarı import et (simplified)</para>
<para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>keyType</parametername>
</parameternamelist>
<parameterdescription>
<para>Anahtar tipi </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>keyData</parametername>
</parameternamelist>
<parameterdescription>
<para>Anahtar verisi </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>keyDataLen</parametername>
</parameternamelist>
<parameterdescription>
<para>Anahtar verisi uzunluğu </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>keyLabel</parametername>
</parameternamelist>
<parameterdescription>
<para>Anahtar etiketi </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>keyId</parametername>
</parameternamelist>
<parameterdescription>
<para>Çıktı: İçe aktarılan anahtar ID&apos;si </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>ErrorCode Başarı durumu</para>
</simplesect>
</para>
<para>Belirtilen anahtar verisini token üzerine import eder. C_CreateObject kullanılarak anahtar oluşturulur ve token üzerinde saklanır.</para>
<para><simplesect kind="note"><para>Bu fonksiyon, açık bir session gerektirir (<ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a1dd53afa782d6054163658a225a3e3bf" kindref="member">openToken()</ref> çağrılmış olmalı). Desteklenen anahtar tipleri: AES-256, RSA-2048, EC-P256. Anahtar, token üzerinde saklanır ve keyId olarak döndürülür.</para>
</simplesect>
<parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>keyType</parametername>
</parameternamelist>
<parameterdescription>
<para>Anahtar tipi (AES_256, RSA_2048, EC_P256) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>keyData</parametername>
</parameternamelist>
<parameterdescription>
<para>Import edilecek anahtar verisi (nullptr ise InvalidInput döner) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>keyDataLen</parametername>
</parameternamelist>
<parameterdescription>
<para>Anahtar verisi uzunluğu (byte, 0 ise InvalidInput döner) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>keyLabel</parametername>
</parameternamelist>
<parameterdescription>
<para>Anahtar etiketi (nullptr ise InvalidInput döner) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>keyId</parametername>
</parameternamelist>
<parameterdescription>
<para>Import edilen anahtarın ID&apos;si (çıktı, nullptr ise InvalidInput döner) </para>
</parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>keyIdLen</parametername>
</parameternamelist>
<parameterdescription>
<para>keyId buffer boyutu (giriş), oluşturulan ID boyutu (çıktı) </para>
</parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>ErrorCode Başarı durumu </para>
</simplesect>
</para>
        </detaileddescription>
        <inbodydescription>
<para>PKCS#11 attribute template oluşturma (import için)</para>
<para>Import edilecek anahtar için PKCS#11 attribute template&apos;i oluşturulur. Anahtar tipine göre farklı key class ve key type kullanılır.</para>
<para>&lt; Attribute template dizisi (max 10 attribute)</para>
<para>&lt; Template attribute sayısı</para>
<para>&lt; Varsayılan: Secret key (AES için)</para>
<para>&lt; Varsayılan: AES key type</para>
<para>&lt; Boolean true değeri</para>
<para>Anahtar tipine göre key class ve key type ayarlama</para>
<para>Her anahtar tipi için farklı key class ve key type kullanılır:<itemizedlist>
<listitem><para>AES_256: CKO_SECRET_KEY, CKK_AES</para>
</listitem><listitem><para>RSA_2048: CKO_PRIVATE_KEY, CKK_RSA</para>
</listitem><listitem><para>EC_P256: CKO_PRIVATE_KEY, CKK_EC</para>
</listitem></itemizedlist>
</para>
<para>PKCS#11 attribute template oluşturma (import anahtar için)</para>
<para>Import edilecek anahtar için gerekli attribute&apos;lar oluşturulur:<itemizedlist>
<listitem><para>CKA_CLASS: Anahtar sınıfı (secret key veya private key)</para>
</listitem><listitem><para>CKA_KEY_TYPE: Anahtar tipi (AES, RSA, EC)</para>
</listitem><listitem><para>CKA_LABEL: Anahtar etiketi</para>
</listitem><listitem><para>CKA_VALUE: Anahtar verisi (import edilecek anahtar)</para>
</listitem><listitem><para>CKA_TOKEN: Token&apos;da saklanacak (kalıcı)</para>
</listitem><listitem><para>CKA_ENCRYPT/CKA_DECRYPT: Şifreleme/şifre çözme için kullanılabilir</para>
</listitem></itemizedlist>
</para>
<para>&lt; Anahtar sınıfı</para>
<para>&lt; Anahtar tipi</para>
<para>&lt; Anahtar etiketi</para>
<para>&lt; Anahtar verisi (import edilecek)</para>
<para>&lt; Token&apos;da saklanacak (kalıcı)</para>
<para>&lt; Şifreleme için kullanılabilir</para>
<para>&lt; Şifre çözme için kullanılabilir</para>
<para>PKCS#11 anahtar oluşturma (import)</para>
<para>C_CreateObject ile import edilecek anahtar token üzerinde oluşturulur. Anahtar verisi (CKA_VALUE) template içinde belirtilir.</para>
<para>&lt; Oluşturulan anahtar handle&apos;ı</para>
<para>Key ID oluşturma (import için)</para>
<para>Import edilen anahtarın handle&apos;ı keyId olarak kullanılır. keyId buffer, CK_OBJECT_HANDLE boyutunda olmalıdır. Eğer buffer yeterli değilse, InvalidInput hatası döner.</para>
<para>Key ID buffer yeterli: handle&apos;ı kopyala</para>
<para>Key ID buffer yetersiz: hata döner</para>
<para>Import işleminde, keyId buffer mutlaka CK_OBJECT_HANDLE boyutunda olmalıdır. Aksi takdirde, handle kopyalanamaz.</para>
<para>PKCS#11 attribute template oluşturma (import için)</para>
<para>Import edilecek anahtar için PKCS#11 attribute template&apos;i oluşturulur. Anahtar tipine göre farklı key class ve key type kullanılır.</para>
<para>&lt; Attribute template dizisi (max 10 attribute)</para>
<para>&lt; Template attribute sayısı</para>
<para>&lt; Varsayılan: Secret key (AES için)</para>
<para>&lt; Varsayılan: AES key type</para>
<para>&lt; Boolean true değeri</para>
<para>Anahtar tipine göre key class ve key type ayarlama</para>
<para>Her anahtar tipi için farklı key class ve key type kullanılır:<itemizedlist>
<listitem><para>AES_256: CKO_SECRET_KEY, CKK_AES</para>
</listitem><listitem><para>RSA_2048: CKO_PRIVATE_KEY, CKK_RSA</para>
</listitem><listitem><para>EC_P256: CKO_PRIVATE_KEY, CKK_EC</para>
</listitem></itemizedlist>
</para>
<para>PKCS#11 attribute template oluşturma (import anahtar için)</para>
<para>Import edilecek anahtar için gerekli attribute&apos;lar oluşturulur:<itemizedlist>
<listitem><para>CKA_CLASS: Anahtar sınıfı (secret key veya private key)</para>
</listitem><listitem><para>CKA_KEY_TYPE: Anahtar tipi (AES, RSA, EC)</para>
</listitem><listitem><para>CKA_LABEL: Anahtar etiketi</para>
</listitem><listitem><para>CKA_VALUE: Anahtar verisi (import edilecek anahtar)</para>
</listitem><listitem><para>CKA_TOKEN: Token&apos;da saklanacak (kalıcı)</para>
</listitem><listitem><para>CKA_ENCRYPT/CKA_DECRYPT: Şifreleme/şifre çözme için kullanılabilir</para>
</listitem></itemizedlist>
</para>
<para>&lt; Anahtar sınıfı</para>
<para>&lt; Anahtar tipi</para>
<para>&lt; Anahtar etiketi</para>
<para>&lt; Anahtar verisi (import edilecek)</para>
<para>&lt; Token&apos;da saklanacak (kalıcı)</para>
<para>&lt; Şifreleme için kullanılabilir</para>
<para>&lt; Şifre çözme için kullanılabilir</para>
<para>PKCS#11 anahtar oluşturma (import)</para>
<para>C_CreateObject ile import edilecek anahtar token üzerinde oluşturulur. Anahtar verisi (CKA_VALUE) template içinde belirtilir.</para>
<para>&lt; Oluşturulan anahtar handle&apos;ı</para>
<para>Key ID oluşturma (import için)</para>
<para>Import edilen anahtarın handle&apos;ı keyId olarak kullanılır. keyId buffer, CK_OBJECT_HANDLE boyutunda olmalıdır. Eğer buffer yeterli değilse, InvalidInput hatası döner.</para>
<para>Key ID buffer yeterli: handle&apos;ı kopyala</para>
<para>Key ID buffer yetersiz: hata döner</para>
<para>Import işleminde, keyId buffer mutlaka CK_OBJECT_HANDLE boyutunda olmalıdır. Aksi takdirde, handle kopyalanamaz.</para>
        </inbodydescription>
        <location file="src/travelexpense/src/softhsm.cpp" line="1382" column="11" bodyfile="src/travelexpense/src/softhsm.cpp" bodystart="1382" bodyend="1502" declfile="src/travelexpense/header/softhsm.h" declline="136" declcolumn="29"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
<para>Seyahat Gideri Takibi - <ref refid="namespace_soft_h_s_m" kindref="compound">SoftHSM</ref> (PKCS#11) Implementation. </para>
    </briefdescription>
    <detaileddescription>
<para>Bu dosya, <ref refid="namespace_soft_h_s_m" kindref="compound">SoftHSM</ref> kullanarak PKCS#11 standardı üzerinden kriptografik işlemler yapmak için gerekli fonksiyonların implementasyonlarını içerir.</para>
<para><simplesect kind="author"><para>Binnur Altınışık </para>
</simplesect>
<simplesect kind="date"><para>2025 </para>
</simplesect>
</para>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../header/softhsm.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../header/safe_string.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="comment">//<sp/>PKCS11<sp/>macro<sp/>redefinition<sp/>önlemek<sp/>için<sp/>koruma<sp/>ekle</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="preprocessor">#ifndef<sp/>PKCS11_NO_EXPORTS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/>#define<sp/>PKCS11_NO_EXPORTS</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;../third_party/pkcs11/pkcs11.h&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="20"><highlight class="normal"></highlight></codeline>
<codeline lineno="21"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;cstring&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="22"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;vector&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="23"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;memory&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="24"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;cstdio&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="25"><highlight class="normal"></highlight></codeline>
<codeline lineno="26"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_WIN32</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="27"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;io.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="28"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>FILE_EXISTS(path)<sp/>(_access(path,<sp/>0)<sp/>==<sp/>0)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="29"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="30"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;unistd.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">inline</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>file_exists_helper(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*path)<sp/>{</highlight></codeline>
<codeline lineno="42"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>access(path,<sp/>F_OK)<sp/>==<sp/>0;</highlight></codeline>
<codeline lineno="43"><highlight class="normal">}</highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight><highlight class="preprocessor">#define<sp/>FILE_EXISTS(path)<sp/>file_exists_helper(path)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="46"><highlight class="normal"></highlight></codeline>
<codeline lineno="47"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_WIN32</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="48"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/>#define<sp/>WIN32_LEAN_AND_MEAN</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="49"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/>#define<sp/>NOMINMAX</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="50"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/>#include<sp/>&lt;windows.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="51"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Windows<sp/>header<sp/>dosyaları<sp/>ERROR<sp/>ve<sp/>ERROR_*<sp/>makroları<sp/>tanımlar,<sp/>bunları<sp/>undef<sp/>ediyoruz</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="52"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>çünkü<sp/>bizim<sp/>ErrorCode<sp/>ve<sp/>InitStatus<sp/>enum<sp/>değerlerimizle<sp/>çakışıyorlar</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="53"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/>#undef<sp/>ERROR</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="54"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/>#undef<sp/>ERROR_FILE_NOT_FOUND</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="55"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/>#undef<sp/>ERROR_INVALID_INPUT</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="56"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/>#undef<sp/>ERROR_ENCRYPTION_FAILED</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="57"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/>#undef<sp/>ERROR_UNKNOWN</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="58"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/>#define<sp/>DL_HANDLE<sp/>HMODULE</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="59"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/>#define<sp/>DL_OPEN(path)<sp/>LoadLibraryA(path)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="60"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/>#define<sp/>DL_CLOSE(handle)<sp/>FreeLibrary(handle)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="61"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/>#define<sp/>DL_SYM(handle,<sp/>name)<sp/>GetProcAddress(handle,<sp/>name)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="62"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/>#define<sp/>DL_ERROR()<sp/>GetLastError()</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="63"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="64"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/>#include<sp/>&lt;dlfcn.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="65"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/>#define<sp/>DL_HANDLE<sp/>void*</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="66"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/>#define<sp/>DL_OPEN(path)<sp/>dlopen(path,<sp/>RTLD_NOW)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="67"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/>#define<sp/>DL_CLOSE(handle)<sp/>dlclose(handle)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="68"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/>#define<sp/>DL_SYM(handle,<sp/>name)<sp/>dlsym(handle,<sp/>name)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="69"><highlight class="normal"></highlight><highlight class="preprocessor"><sp/><sp/>#define<sp/>DL_ERROR()<sp/>dlerror()</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="70"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="71"><highlight class="normal"></highlight></codeline>
<codeline lineno="72"><highlight class="normal"></highlight><highlight class="keyword">namespace<sp/></highlight><highlight class="normal"><ref refid="namespace_travel_expense" kindref="compound">TravelExpense</ref><sp/>{</highlight></codeline>
<codeline lineno="73"><highlight class="normal"></highlight></codeline>
<codeline lineno="74"><highlight class="normal"></highlight><highlight class="keyword">namespace<sp/></highlight><highlight class="normal"><ref refid="namespace_soft_h_s_m" kindref="compound">SoftHSM</ref><sp/>{</highlight></codeline>
<codeline lineno="75"><highlight class="normal"></highlight></codeline>
<codeline lineno="76"><highlight class="normal"></highlight><highlight class="comment">//<sp/>Using<sp/>directive<sp/>for<sp/>ErrorCode</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="77"><highlight class="normal"></highlight><highlight class="keyword">using<sp/></highlight><highlight class="normal"><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a6fb8347ca19497bb25f5f0a6e696d96f" kindref="member">ErrorCode</ref><sp/>=<sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383dab" kindref="member">TravelExpense::ErrorCode</ref>;</highlight></codeline>
<codeline lineno="78"><highlight class="normal"></highlight></codeline>
<codeline lineno="86"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="softhsm_8cpp_1a3b81e0f561932d8761fb8675437e2659" kindref="member">DL_HANDLE</ref><sp/>g_pkcs11Library<sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="88"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>CK_FUNCTION_LIST<sp/>*g_pFunctionList<sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="90"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>CK_SLOT_ID<sp/>g_currentSlot<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="92"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/>CK_SESSION_HANDLE<sp/>g_sessionHandle<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="94"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1aad0a58fc42af71a6793bf6449a75b24a" kindref="member">InitStatus</ref><sp/>g_status<sp/>=<sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1aad0a58fc42af71a6793bf6449a75b24aa02de9649e258d1dd94056e676061e969" kindref="member">InitStatus::NOT_INITIALIZED</ref>;</highlight></codeline>
<codeline lineno="96"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>g_tokenLabel[64]<sp/>=<sp/>{<sp/>0<sp/>};</highlight></codeline>
<codeline lineno="98"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>g_pin[32]<sp/>=<sp/>{<sp/>0<sp/>};</highlight></codeline>
<codeline lineno="99"><highlight class="normal"></highlight></codeline>
<codeline lineno="111"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a6fb8347ca19497bb25f5f0a6e696d96f" kindref="member">ErrorCode</ref><sp/>pkcs11ToErrorCode(CK_ULONG<sp/>rv)<sp/>{</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(rv)<sp/>{</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>CKR_OK:</highlight></codeline>
<codeline lineno="114"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383daba505a83f220c02df2f85c3810cd9ceb38" kindref="member">ErrorCode::Success</ref>;</highlight></codeline>
<codeline lineno="115"><highlight class="normal"></highlight></codeline>
<codeline lineno="116"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>CKR_ARGUMENTS_BAD:</highlight></codeline>
<codeline lineno="117"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383dabad8f78ca9a692a9411afbc7584b69d043" kindref="member">ErrorCode::InvalidInput</ref>;</highlight></codeline>
<codeline lineno="118"><highlight class="normal"></highlight></codeline>
<codeline lineno="119"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>CKR_PIN_INCORRECT:</highlight></codeline>
<codeline lineno="120"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>CKR_PIN_INVALID:</highlight></codeline>
<codeline lineno="121"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383dabad8f78ca9a692a9411afbc7584b69d043" kindref="member">ErrorCode::InvalidInput</ref>;</highlight></codeline>
<codeline lineno="122"><highlight class="normal"></highlight></codeline>
<codeline lineno="123"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>CKR_TOKEN_NOT_PRESENT:</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>CKR_TOKEN_NOT_RECOGNIZED:</highlight></codeline>
<codeline lineno="125"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383daba2767828026039e8ba7b38973cbb701f2" kindref="member">ErrorCode::FileNotFound</ref>;</highlight></codeline>
<codeline lineno="126"><highlight class="normal"></highlight></codeline>
<codeline lineno="127"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>CKR_SESSION_HANDLE_INVALID:</highlight></codeline>
<codeline lineno="128"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383dabad8f78ca9a692a9411afbc7584b69d043" kindref="member">ErrorCode::InvalidInput</ref>;</highlight></codeline>
<codeline lineno="129"><highlight class="normal"></highlight></codeline>
<codeline lineno="130"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>CKR_OBJECT_HANDLE_INVALID:</highlight></codeline>
<codeline lineno="131"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383dabad8f78ca9a692a9411afbc7584b69d043" kindref="member">ErrorCode::InvalidInput</ref>;</highlight></codeline>
<codeline lineno="132"><highlight class="normal"></highlight></codeline>
<codeline lineno="133"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>CKR_MECHANISM_INVALID:</highlight></codeline>
<codeline lineno="134"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383dabad8f78ca9a692a9411afbc7584b69d043" kindref="member">ErrorCode::InvalidInput</ref>;</highlight></codeline>
<codeline lineno="135"><highlight class="normal"></highlight></codeline>
<codeline lineno="136"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>CKR_FUNCTION_FAILED:</highlight></codeline>
<codeline lineno="137"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383dabaf8bf95b659f617159eb42c2099352a26" kindref="member">ErrorCode::EncryptionFailed</ref>;</highlight></codeline>
<codeline lineno="138"><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383daba88183b946cc5f0e8c96b2e66e1c74a7e" kindref="member">ErrorCode::Unknown</ref>;</highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="142"><highlight class="normal">}</highlight></codeline>
<codeline lineno="143"><highlight class="normal"></highlight></codeline>
<codeline lineno="165"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*findSoftHSMLibrary()<sp/>{</highlight></codeline>
<codeline lineno="166"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Windows<sp/>için</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="167"><highlight class="normal"></highlight><highlight class="preprocessor">#ifdef<sp/>_WIN32</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>SoftHSM<sp/>için<sp/>olası<sp/>yollar</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="169"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*paths[]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="170"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;softhsm2.dll&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="171"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;C:\\Program<sp/>Files\\SoftHSM2\\lib\\softhsm2.dll&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="172"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;C:\\Program<sp/>Files<sp/>(x86)\\SoftHSM2\\lib\\softhsm2.dll&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="173"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="174"><highlight class="normal"><sp/><sp/>};</highlight></codeline>
<codeline lineno="175"><highlight class="normal"></highlight></codeline>
<codeline lineno="176"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>paths[i]<sp/>!=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="177"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Dosyanın<sp/>varlığını<sp/>kontrol<sp/>et</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="178"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="softhsm_8cpp_1a4bdc0245afe661f69ff2948076aaaf1b" kindref="member">FILE_EXISTS</ref>(paths[i]))<sp/>{</highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>paths[i];</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="181"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="182"><highlight class="normal"></highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="184"><highlight class="normal"></highlight><highlight class="preprocessor">#else</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Linux<sp/>için</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="186"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*paths[]<sp/>=<sp/>{</highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;libsofthsm2.so&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;/usr/lib/softhsm/libsofthsm2.so&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="189"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;/usr/local/lib/softhsm/libsofthsm2.so&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;/usr/lib/x86_64-linux-gnu/softhsm/libsofthsm2.so&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="191"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="stringliteral">&quot;/opt/softhsm2/lib/libsofthsm2.so&quot;</highlight><highlight class="normal">,</highlight></codeline>
<codeline lineno="192"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="193"><highlight class="normal"><sp/><sp/>};</highlight></codeline>
<codeline lineno="194"><highlight class="normal"></highlight></codeline>
<codeline lineno="195"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>paths[i]<sp/>!=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="196"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Dosyanın<sp/>varlığını<sp/>kontrol<sp/>et</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="197"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(<ref refid="softhsm_8cpp_1a4bdc0245afe661f69ff2948076aaaf1b" kindref="member">FILE_EXISTS</ref>(paths[i]))<sp/>{</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>paths[i];</highlight></codeline>
<codeline lineno="199"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="200"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="201"><highlight class="normal"></highlight></codeline>
<codeline lineno="202"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="203"><highlight class="normal"></highlight><highlight class="preprocessor">#endif</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="204"><highlight class="normal">}</highlight></codeline>
<codeline lineno="205"><highlight class="normal"></highlight></codeline>
<codeline lineno="220"><highlight class="normal"></highlight><highlight class="keyword">static</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a6fb8347ca19497bb25f5f0a6e696d96f" kindref="member">ErrorCode</ref><sp/>loadPKCS11Library(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*libraryPath)<sp/>{</highlight></codeline>
<codeline lineno="221"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(g_pkcs11Library<sp/>!=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="222"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Zaten<sp/>yüklü</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="223"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383daba505a83f220c02df2f85c3810cd9ceb38" kindref="member">ErrorCode::Success</ref>;</highlight></codeline>
<codeline lineno="224"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="225"><highlight class="normal"></highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*path<sp/>=<sp/>libraryPath;</highlight></codeline>
<codeline lineno="227"><highlight class="normal"></highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!path)<sp/>{</highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/>path<sp/>=<sp/>findSoftHSMLibrary();</highlight></codeline>
<codeline lineno="230"><highlight class="normal"></highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!path)<sp/>{</highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383daba2767828026039e8ba7b38973cbb701f2" kindref="member">ErrorCode::FileNotFound</ref>;</highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="234"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="235"><highlight class="normal"></highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/>g_pkcs11Library<sp/>=<sp/><ref refid="softhsm_8cpp_1a1c69bc484d5f594765b1e700999dc470" kindref="member">DL_OPEN</ref>(path);</highlight></codeline>
<codeline lineno="237"><highlight class="normal"></highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!g_pkcs11Library)<sp/>{</highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383daba2767828026039e8ba7b38973cbb701f2" kindref="member">ErrorCode::FileNotFound</ref>;</highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="241"><highlight class="normal"></highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>C_GetFunctionList<sp/>fonksiyonunu<sp/>al</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="243"><highlight class="normal"><sp/><sp/>CK_C_GetFunctionList<sp/>C_GetFunctionList<sp/>=</highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">reinterpret_cast&lt;</highlight><highlight class="normal">CK_C_GetFunctionList</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(<ref refid="softhsm_8cpp_1a292a39d6dd5417956880f1eb1b656ce5" kindref="member">DL_SYM</ref>(g_pkcs11Library,<sp/></highlight><highlight class="stringliteral">&quot;C_GetFunctionList&quot;</highlight><highlight class="normal">));</highlight></codeline>
<codeline lineno="245"><highlight class="normal"></highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!C_GetFunctionList)<sp/>{</highlight></codeline>
<codeline lineno="247"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="softhsm_8cpp_1ac2c1c282afbcfd1fdda90bb1b922f97c" kindref="member">DL_CLOSE</ref>(g_pkcs11Library);</highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/>g_pkcs11Library<sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383daba2767828026039e8ba7b38973cbb701f2" kindref="member">ErrorCode::FileNotFound</ref>;</highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="251"><highlight class="normal"></highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Function<sp/>list&apos;i<sp/>al</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="253"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>rv<sp/>=<sp/>C_GetFunctionList(&amp;g_pFunctionList);</highlight></codeline>
<codeline lineno="254"><highlight class="normal"></highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rv<sp/>!=<sp/>CKR_OK<sp/>||<sp/>!g_pFunctionList)<sp/>{</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="softhsm_8cpp_1ac2c1c282afbcfd1fdda90bb1b922f97c" kindref="member">DL_CLOSE</ref>(g_pkcs11Library);</highlight></codeline>
<codeline lineno="257"><highlight class="normal"><sp/><sp/><sp/><sp/>g_pkcs11Library<sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383daba88183b946cc5f0e8c96b2e66e1c74a7e" kindref="member">ErrorCode::Unknown</ref>;</highlight></codeline>
<codeline lineno="259"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="260"><highlight class="normal"></highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383daba505a83f220c02df2f85c3810cd9ceb38" kindref="member">ErrorCode::Success</ref>;</highlight></codeline>
<codeline lineno="262"><highlight class="normal">}</highlight></codeline>
<codeline lineno="263"><highlight class="normal"></highlight></codeline>
<codeline lineno="280"><highlight class="normal"><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a6fb8347ca19497bb25f5f0a6e696d96f" kindref="member">ErrorCode</ref><sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1af71b3824984e7e34e84fc5c0a606b418" kindref="member">initialize</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*libraryPath,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*tokenLabel,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*pin)<sp/>{</highlight></codeline>
<codeline lineno="281"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(g_status<sp/>==<sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1aad0a58fc42af71a6793bf6449a75b24aadee5f03c2c4e73657824e028494b18c0" kindref="member">InitStatus::INITIALIZED</ref>)<sp/>{</highlight></codeline>
<codeline lineno="282"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Zaten<sp/>başlatılmış</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="283"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383daba505a83f220c02df2f85c3810cd9ceb38" kindref="member">ErrorCode::Success</ref>;</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="285"><highlight class="normal"></highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>PKCS#11<sp/>kütüphanesini<sp/>yükle</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a6fb8347ca19497bb25f5f0a6e696d96f" kindref="member">ErrorCode</ref><sp/>result<sp/>=<sp/>loadPKCS11Library(libraryPath);</highlight></codeline>
<codeline lineno="288"><highlight class="normal"></highlight></codeline>
<codeline lineno="289"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(result<sp/>!=<sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383daba505a83f220c02df2f85c3810cd9ceb38" kindref="member">ErrorCode::Success</ref>)<sp/>{</highlight></codeline>
<codeline lineno="290"><highlight class="normal"><sp/><sp/><sp/><sp/>g_status<sp/>=<sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1aad0a58fc42af71a6793bf6449a75b24aabb1ca97ec761fc37101737ba0aa2e7c5" kindref="member">InitStatus::ERROR</ref>;</highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>result;</highlight></codeline>
<codeline lineno="292"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="293"><highlight class="normal"></highlight></codeline>
<codeline lineno="294"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>PKCS#11&apos;yi<sp/>başlat</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="295"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>rv<sp/>=<sp/>g_pFunctionList-&gt;C_Initialize(</highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="296"><highlight class="normal"></highlight></codeline>
<codeline lineno="297"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rv<sp/>!=<sp/>CKR_OK<sp/>&amp;&amp;<sp/>rv<sp/>!=<sp/>CKR_CRYPTOKI_ALREADY_INITIALIZED)<sp/>{</highlight></codeline>
<codeline lineno="298"><highlight class="normal"><sp/><sp/><sp/><sp/>g_status<sp/>=<sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1aad0a58fc42af71a6793bf6449a75b24aabb1ca97ec761fc37101737ba0aa2e7c5" kindref="member">InitStatus::ERROR</ref>;</highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>pkcs11ToErrorCode(rv);</highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="301"><highlight class="normal"></highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Token<sp/>label<sp/>ve<sp/>PIN&apos;i<sp/>sakla</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(tokenLabel)<sp/>{</highlight></codeline>
<codeline lineno="304"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespace_travel_expense_1_1_safe_string_1a5555a53d845f3644d0dfc17c0f097075" kindref="member">SafeString::safeCopy</ref>(g_tokenLabel,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(g_tokenLabel),<sp/>tokenLabel);</highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespace_travel_expense_1_1_safe_string_1a5555a53d845f3644d0dfc17c0f097075" kindref="member">SafeString::safeCopy</ref>(g_tokenLabel,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(g_tokenLabel),<sp/></highlight><highlight class="stringliteral">&quot;TravelExpense&quot;</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="308"><highlight class="normal"></highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(pin)<sp/>{</highlight></codeline>
<codeline lineno="310"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespace_travel_expense_1_1_safe_string_1a5555a53d845f3644d0dfc17c0f097075" kindref="member">SafeString::safeCopy</ref>(g_pin,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(g_pin),<sp/>pin);</highlight></codeline>
<codeline lineno="311"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="312"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="namespace_travel_expense_1_1_safe_string_1a5555a53d845f3644d0dfc17c0f097075" kindref="member">SafeString::safeCopy</ref>(g_pin,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(g_pin),<sp/></highlight><highlight class="stringliteral">&quot;1234&quot;</highlight><highlight class="normal">);<sp/><sp/></highlight><highlight class="comment">//<sp/>Varsayılan<sp/>PIN</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="313"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="314"><highlight class="normal"></highlight></codeline>
<codeline lineno="315"><highlight class="normal"><sp/><sp/>g_status<sp/>=<sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1aad0a58fc42af71a6793bf6449a75b24aadee5f03c2c4e73657824e028494b18c0" kindref="member">InitStatus::INITIALIZED</ref>;</highlight></codeline>
<codeline lineno="316"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383daba505a83f220c02df2f85c3810cd9ceb38" kindref="member">ErrorCode::Success</ref>;</highlight></codeline>
<codeline lineno="317"><highlight class="normal">}</highlight></codeline>
<codeline lineno="318"><highlight class="normal"></highlight></codeline>
<codeline lineno="331"><highlight class="normal"><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a6fb8347ca19497bb25f5f0a6e696d96f" kindref="member">ErrorCode</ref><sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1aa08cccf8f5db8d63231a3b706351b212" kindref="member">shutdown</ref>()<sp/>{</highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(g_status<sp/>!=<sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1aad0a58fc42af71a6793bf6449a75b24aadee5f03c2c4e73657824e028494b18c0" kindref="member">InitStatus::INITIALIZED</ref>)<sp/>{</highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383daba505a83f220c02df2f85c3810cd9ceb38" kindref="member">ErrorCode::Success</ref>;</highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="335"><highlight class="normal"></highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Session&apos;ı<sp/>kapat</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="337"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(g_sessionHandle<sp/>!=<sp/>0<sp/>&amp;&amp;<sp/>g_pFunctionList)<sp/>{</highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/>g_pFunctionList-&gt;C_CloseSession(g_sessionHandle);</highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/>g_sessionHandle<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="341"><highlight class="normal"></highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>PKCS#11&apos;yi<sp/>kapat</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="343"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(g_pFunctionList)<sp/>{</highlight></codeline>
<codeline lineno="344"><highlight class="normal"><sp/><sp/><sp/><sp/>g_pFunctionList-&gt;C_Finalize(</highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">);</highlight></codeline>
<codeline lineno="345"><highlight class="normal"><sp/><sp/><sp/><sp/>g_pFunctionList<sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="346"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="347"><highlight class="normal"></highlight></codeline>
<codeline lineno="348"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Kütüphaneyi<sp/>kapat</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="349"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(g_pkcs11Library)<sp/>{</highlight></codeline>
<codeline lineno="350"><highlight class="normal"><sp/><sp/><sp/><sp/><ref refid="softhsm_8cpp_1ac2c1c282afbcfd1fdda90bb1b922f97c" kindref="member">DL_CLOSE</ref>(g_pkcs11Library);</highlight></codeline>
<codeline lineno="351"><highlight class="normal"><sp/><sp/><sp/><sp/>g_pkcs11Library<sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="353"><highlight class="normal"></highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/>g_status<sp/>=<sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1aad0a58fc42af71a6793bf6449a75b24aa02de9649e258d1dd94056e676061e969" kindref="member">InitStatus::NOT_INITIALIZED</ref>;</highlight></codeline>
<codeline lineno="355"><highlight class="normal"><sp/><sp/>std::memset(g_tokenLabel,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(g_tokenLabel));</highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/>std::memset(g_pin,<sp/>0,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(g_pin));</highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383daba505a83f220c02df2f85c3810cd9ceb38" kindref="member">ErrorCode::Success</ref>;</highlight></codeline>
<codeline lineno="358"><highlight class="normal">}</highlight></codeline>
<codeline lineno="359"><highlight class="normal"></highlight></codeline>
<codeline lineno="367"><highlight class="normal"><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1aad0a58fc42af71a6793bf6449a75b24a" kindref="member">InitStatus</ref><sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a0fa272e6522244baa0af55f77332e6f5" kindref="member">getStatus</ref>()<sp/>{</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>g_status;</highlight></codeline>
<codeline lineno="369"><highlight class="normal">}</highlight></codeline>
<codeline lineno="370"><highlight class="normal"></highlight></codeline>
<codeline lineno="386"><highlight class="normal"><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a6fb8347ca19497bb25f5f0a6e696d96f" kindref="member">ErrorCode</ref><sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a0d330cfb5deff1a7731392c78c8a4757" kindref="member">createToken</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*label,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*pin,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*soPin)<sp/>{</highlight></codeline>
<codeline lineno="387"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>SoftHSM<sp/>token&apos;ları<sp/>genellikle<sp/>sistem<sp/>seviyesinde<sp/>oluşturulur</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="388"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Burada<sp/>sadece<sp/>label&apos;i<sp/>kaydediyoruz</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="389"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!label<sp/>||<sp/>!pin)<sp/>{</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383dabad8f78ca9a692a9411afbc7584b69d043" kindref="member">ErrorCode::InvalidInput</ref>;</highlight></codeline>
<codeline lineno="391"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="392"><highlight class="normal"></highlight></codeline>
<codeline lineno="393"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Token<sp/>oluşturma<sp/>için<sp/>SoftHSM<sp/>CLI<sp/>komutları<sp/>gerekir</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="394"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Bu<sp/>fonksiyon<sp/>sadece<sp/>parametreleri<sp/>saklar</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="395"><highlight class="normal"><sp/><sp/><ref refid="namespace_travel_expense_1_1_safe_string_1a5555a53d845f3644d0dfc17c0f097075" kindref="member">SafeString::safeCopy</ref>(g_tokenLabel,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(g_tokenLabel),<sp/>label);</highlight></codeline>
<codeline lineno="396"><highlight class="normal"><sp/><sp/><ref refid="namespace_travel_expense_1_1_safe_string_1a5555a53d845f3644d0dfc17c0f097075" kindref="member">SafeString::safeCopy</ref>(g_pin,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(g_pin),<sp/>pin);</highlight></codeline>
<codeline lineno="397"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383daba505a83f220c02df2f85c3810cd9ceb38" kindref="member">ErrorCode::Success</ref>;</highlight></codeline>
<codeline lineno="398"><highlight class="normal">}</highlight></codeline>
<codeline lineno="399"><highlight class="normal"></highlight></codeline>
<codeline lineno="415"><highlight class="normal"><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a6fb8347ca19497bb25f5f0a6e696d96f" kindref="member">ErrorCode</ref><sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a1dd53afa782d6054163658a225a3e3bf" kindref="member">openToken</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*label,<sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*pin)<sp/>{</highlight></codeline>
<codeline lineno="416"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(g_status<sp/>!=<sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1aad0a58fc42af71a6793bf6449a75b24aadee5f03c2c4e73657824e028494b18c0" kindref="member">InitStatus::INITIALIZED</ref><sp/>||<sp/>!g_pFunctionList)<sp/>{</highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383dabad8f78ca9a692a9411afbc7584b69d043" kindref="member">ErrorCode::InvalidInput</ref>;</highlight></codeline>
<codeline lineno="418"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="419"><highlight class="normal"></highlight></codeline>
<codeline lineno="426"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Slot<sp/>listesini<sp/>al</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="427"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>slotCount<sp/>=<sp/>0;<sp/><sp/></highlight></codeline>
<codeline lineno="428"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>rv<sp/>=<sp/>g_pFunctionList-&gt;C_GetSlotList(CK_TRUE,<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">,<sp/>&amp;slotCount);</highlight></codeline>
<codeline lineno="429"><highlight class="normal"></highlight></codeline>
<codeline lineno="430"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rv<sp/>!=<sp/>CKR_OK<sp/>||<sp/>slotCount<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="431"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>pkcs11ToErrorCode(rv);</highlight></codeline>
<codeline lineno="432"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="433"><highlight class="normal"></highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/>std::vector&lt;CK_SLOT_ID&gt;<sp/>slots(slotCount);<sp/><sp/></highlight></codeline>
<codeline lineno="435"><highlight class="normal"><sp/><sp/>rv<sp/>=<sp/>g_pFunctionList-&gt;C_GetSlotList(CK_TRUE,<sp/>slots.data(),<sp/>&amp;slotCount);</highlight></codeline>
<codeline lineno="436"><highlight class="normal"></highlight></codeline>
<codeline lineno="437"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rv<sp/>!=<sp/>CKR_OK)<sp/>{</highlight></codeline>
<codeline lineno="438"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>pkcs11ToErrorCode(rv);</highlight></codeline>
<codeline lineno="439"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="440"><highlight class="normal"></highlight></codeline>
<codeline lineno="448"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Label&apos;a<sp/>göre<sp/>token<sp/>bul</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="449"><highlight class="normal"><sp/><sp/>CK_SLOT_ID<sp/>selectedSlot<sp/>=<sp/>slots[0];<sp/><sp/></highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*searchLabel<sp/>=<sp/>label<sp/>?<sp/>label<sp/>:<sp/>g_tokenLabel;<sp/><sp/></highlight></codeline>
<codeline lineno="458"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(CK_ULONG<sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>slotCount;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="459"><highlight class="normal"><sp/><sp/><sp/><sp/>CK_TOKEN_INFO<sp/>tokenInfo;</highlight></codeline>
<codeline lineno="460"><highlight class="normal"><sp/><sp/><sp/><sp/>rv<sp/>=<sp/>g_pFunctionList-&gt;C_GetTokenInfo(slots[i],<sp/>&amp;tokenInfo);</highlight></codeline>
<codeline lineno="461"><highlight class="normal"></highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rv<sp/>==<sp/>CKR_OK)<sp/>{</highlight></codeline>
<codeline lineno="463"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Label<sp/>karşılaştırması<sp/>(null-terminated<sp/>değil,<sp/>boşluklarla<sp/>doldurulmuş)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>tokenLabel[33]<sp/>=<sp/>{<sp/>0<sp/>};</highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespace_travel_expense_1_1_safe_string_1a5555a53d845f3644d0dfc17c0f097075" kindref="member">SafeString::safeCopy</ref>(tokenLabel,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(tokenLabel),<sp/>tokenInfo.label);</highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Son<sp/>boşlukları<sp/>temizle</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>len<sp/>=<sp/>std::strlen(tokenLabel);</highlight></codeline>
<codeline lineno="468"><highlight class="normal"></highlight></codeline>
<codeline lineno="469"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(len<sp/>&gt;<sp/>0<sp/>&amp;&amp;<sp/>tokenLabel[len<sp/>-<sp/>1]<sp/>==<sp/></highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="470"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>tokenLabel[--len]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="471"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="472"><highlight class="normal"></highlight></codeline>
<codeline lineno="473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(std::strcmp(tokenLabel,<sp/>searchLabel)<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="474"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>selectedSlot<sp/>=<sp/>slots[i];</highlight></codeline>
<codeline lineno="475"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="476"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="477"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="478"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="479"><highlight class="normal"></highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Session<sp/>aç</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>flags<sp/>=<sp/>CKF_RW_SESSION<sp/>|<sp/>CKF_SERIAL_SESSION;<sp/><sp/></highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/>rv<sp/>=<sp/>g_pFunctionList-&gt;C_OpenSession(selectedSlot,<sp/>flags,<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">,<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">,<sp/>&amp;g_sessionHandle);</highlight></codeline>
<codeline lineno="490"><highlight class="normal"></highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rv<sp/>!=<sp/>CKR_OK)<sp/>{</highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>pkcs11ToErrorCode(rv);</highlight></codeline>
<codeline lineno="493"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="494"><highlight class="normal"></highlight></codeline>
<codeline lineno="502"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>PIN<sp/>ile<sp/>login<sp/>yap</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="503"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*loginPin<sp/>=<sp/>pin<sp/>?<sp/>pin<sp/>:<sp/>g_pin;<sp/><sp/></highlight></codeline>
<codeline lineno="504"><highlight class="normal"><sp/><sp/>rv<sp/>=<sp/>g_pFunctionList-&gt;C_Login(g_sessionHandle,<sp/>CKU_USER,</highlight></codeline>
<codeline lineno="505"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">reinterpret_cast&lt;</highlight><highlight class="normal">CK_BYTE<sp/>*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(</highlight><highlight class="keyword">const_cast&lt;</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(loginPin)),</highlight></codeline>
<codeline lineno="506"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">CK_ULONG</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(std::strlen(loginPin)));</highlight></codeline>
<codeline lineno="507"><highlight class="normal"></highlight></codeline>
<codeline lineno="508"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rv<sp/>!=<sp/>CKR_OK<sp/>&amp;&amp;<sp/>rv<sp/>!=<sp/>CKR_USER_ALREADY_LOGGED_IN)<sp/>{</highlight></codeline>
<codeline lineno="509"><highlight class="normal"><sp/><sp/><sp/><sp/>g_pFunctionList-&gt;C_CloseSession(g_sessionHandle);</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/>g_sessionHandle<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>pkcs11ToErrorCode(rv);</highlight></codeline>
<codeline lineno="512"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="513"><highlight class="normal"></highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/>g_currentSlot<sp/>=<sp/>selectedSlot;</highlight></codeline>
<codeline lineno="515"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383daba505a83f220c02df2f85c3810cd9ceb38" kindref="member">ErrorCode::Success</ref>;</highlight></codeline>
<codeline lineno="516"><highlight class="normal">}</highlight></codeline>
<codeline lineno="517"><highlight class="normal"></highlight></codeline>
<codeline lineno="528"><highlight class="normal"><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a6fb8347ca19497bb25f5f0a6e696d96f" kindref="member">ErrorCode</ref><sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a355d45677c9adebfb9afa591275bb8d4" kindref="member">closeToken</ref>()<sp/>{</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(g_sessionHandle<sp/>==<sp/>0<sp/>||<sp/>!g_pFunctionList)<sp/>{</highlight></codeline>
<codeline lineno="530"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383daba505a83f220c02df2f85c3810cd9ceb38" kindref="member">ErrorCode::Success</ref>;</highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="532"><highlight class="normal"></highlight></codeline>
<codeline lineno="533"><highlight class="normal"><sp/><sp/>g_pFunctionList-&gt;C_Logout(g_sessionHandle);</highlight></codeline>
<codeline lineno="534"><highlight class="normal"><sp/><sp/>g_pFunctionList-&gt;C_CloseSession(g_sessionHandle);</highlight></codeline>
<codeline lineno="535"><highlight class="normal"><sp/><sp/>g_sessionHandle<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="536"><highlight class="normal"><sp/><sp/>g_currentSlot<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="537"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383daba505a83f220c02df2f85c3810cd9ceb38" kindref="member">ErrorCode::Success</ref>;</highlight></codeline>
<codeline lineno="538"><highlight class="normal">}</highlight></codeline>
<codeline lineno="539"><highlight class="normal"></highlight></codeline>
<codeline lineno="558"><highlight class="normal"><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a6fb8347ca19497bb25f5f0a6e696d96f" kindref="member">ErrorCode</ref><sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a100a3043a4e2c9d8cd6922248a46f335" kindref="member">generateKey</ref>(<ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a8859119f0e92029bcc9c29081d79021a" kindref="member">KeyType</ref><sp/>keyType,<sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1ada96f17213af3032466f091866ca6e42" kindref="member">KeyUsage</ref><sp/>keyUsage,</highlight></codeline>
<codeline lineno="559"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*keyLabel,<sp/>uint8_t<sp/>*keyId,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>&amp;keyIdLen)<sp/>{</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(g_sessionHandle<sp/>==<sp/>0<sp/>||<sp/>!g_pFunctionList<sp/>||<sp/>!keyLabel<sp/>||<sp/>!keyId)<sp/>{</highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383dabad8f78ca9a692a9411afbc7584b69d043" kindref="member">ErrorCode::InvalidInput</ref>;</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="563"><highlight class="normal"></highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/>CK_MECHANISM<sp/>mechanism<sp/>=<sp/>{<sp/>0<sp/>};</highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/>CK_ATTRIBUTE<sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[10];</highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>templateCount<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Key<sp/>type&apos;a<sp/>göre<sp/>mechanism<sp/>ve<sp/>key<sp/>class<sp/>ayarla</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>keyClass<sp/>=<sp/>CKO_SECRET_KEY;<sp/><sp/></highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>ckKeyType<sp/>=<sp/>CKK_AES;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>keySize<sp/>=<sp/>256<sp/>/<sp/>8;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="586"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(keyType)<sp/>{</highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a8859119f0e92029bcc9c29081d79021aa78a61f5f64f7ea0d31a7cc487d2b14e8" kindref="member">KeyType::AES_256</ref>:</highlight></codeline>
<codeline lineno="588"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>mechanism.mechanism<sp/>=<sp/>CKM_AES_KEY_GEN;</highlight></codeline>
<codeline lineno="589"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>ckKeyType<sp/>=<sp/>CKK_AES;</highlight></codeline>
<codeline lineno="590"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>keySize<sp/>=<sp/>32;<sp/><sp/></highlight><highlight class="comment">//<sp/>256<sp/>bits<sp/>=<sp/>32<sp/>bytes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="591"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="592"><highlight class="normal"></highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a8859119f0e92029bcc9c29081d79021aa5b3bf47dace955c9874047820a78d5b8" kindref="member">KeyType::RSA_2048</ref>:</highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>keyClass<sp/>=<sp/>CKO_PRIVATE_KEY;</highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>mechanism.mechanism<sp/>=<sp/>CKM_RSA_PKCS_KEY_PAIR_GEN;</highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>ckKeyType<sp/>=<sp/>CKK_RSA;</highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>keySize<sp/>=<sp/>0;<sp/><sp/></highlight><highlight class="comment">//<sp/>RSA<sp/>için<sp/>farklı</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="599"><highlight class="normal"></highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a8859119f0e92029bcc9c29081d79021aac5e459c10e5e8348c719df2702c3abe6" kindref="member">KeyType::EC_P256</ref>:</highlight></codeline>
<codeline lineno="601"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>keyClass<sp/>=<sp/>CKO_PRIVATE_KEY;</highlight></codeline>
<codeline lineno="602"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>mechanism.mechanism<sp/>=<sp/>CKM_EC_KEY_PAIR_GEN;</highlight></codeline>
<codeline lineno="603"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>ckKeyType<sp/>=<sp/>CKK_EC;</highlight></codeline>
<codeline lineno="604"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>keySize<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="605"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="606"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="607"><highlight class="normal"></highlight></codeline>
<codeline lineno="614"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Template<sp/>oluştur</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="615"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].type<sp/>=<sp/>CKA_CLASS;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].pValue<sp/>=<sp/>&amp;keyClass;</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].ulValueLen<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(keyClass);</highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/>templateCount++;</highlight></codeline>
<codeline lineno="619"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].type<sp/>=<sp/>CKA_KEY_TYPE;<sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="620"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].pValue<sp/>=<sp/>&amp;ckKeyType;</highlight></codeline>
<codeline lineno="621"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].ulValueLen<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(ckKeyType);</highlight></codeline>
<codeline lineno="622"><highlight class="normal"><sp/><sp/>templateCount++;</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].type<sp/>=<sp/>CKA_LABEL;<sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].pValue<sp/>=<sp/></highlight><highlight class="keyword">const_cast&lt;</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(keyLabel);</highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].ulValueLen<sp/>=<sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">CK_ULONG</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(std::strlen(keyLabel));</highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/>templateCount++;</highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/>CK_BYTE<sp/>true_value<sp/>=<sp/>CK_TRUE;<sp/><sp/><sp/></highlight></codeline>
<codeline lineno="628"><highlight class="normal"><sp/><sp/>CK_BYTE<sp/>false_value<sp/>=<sp/>CK_FALSE;<sp/></highlight></codeline>
<codeline lineno="629"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].type<sp/>=<sp/>CKA_TOKEN;<sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="630"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].pValue<sp/>=<sp/>&amp;true_value;</highlight></codeline>
<codeline lineno="631"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].ulValueLen<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(true_value);</highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/>templateCount++;</highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].type<sp/>=<sp/>CKA_PRIVATE;<sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].pValue<sp/>=<sp/>&amp;true_value;</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].ulValueLen<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(true_value);</highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/>templateCount++;</highlight></codeline>
<codeline lineno="637"><highlight class="normal"></highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Key<sp/>usage<sp/>attributes</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(keyUsage<sp/>==<sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1ada96f17213af3032466f091866ca6e42a52db93ea6808e2184bfb7a4c8a3c0151" kindref="member">KeyUsage::ENCRYPT_DECRYPT</ref>)<sp/>{</highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].type<sp/>=<sp/>CKA_ENCRYPT;</highlight></codeline>
<codeline lineno="648"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].pValue<sp/>=<sp/>&amp;true_value;</highlight></codeline>
<codeline lineno="649"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].ulValueLen<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(true_value);</highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/><sp/><sp/>templateCount++;</highlight></codeline>
<codeline lineno="651"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].type<sp/>=<sp/>CKA_DECRYPT;</highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].pValue<sp/>=<sp/>&amp;true_value;</highlight></codeline>
<codeline lineno="653"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].ulValueLen<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(true_value);</highlight></codeline>
<codeline lineno="654"><highlight class="normal"><sp/><sp/><sp/><sp/>templateCount++;</highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(keyUsage<sp/>==<sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1ada96f17213af3032466f091866ca6e42a6540894fc3bdc9f2597e6d1d4ea0e190" kindref="member">KeyUsage::SIGN_VERIFY</ref>)<sp/>{</highlight></codeline>
<codeline lineno="656"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].type<sp/>=<sp/>CKA_SIGN;</highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].pValue<sp/>=<sp/>&amp;true_value;</highlight></codeline>
<codeline lineno="658"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].ulValueLen<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(true_value);</highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/><sp/><sp/>templateCount++;</highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].type<sp/>=<sp/>CKA_VERIFY;</highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].pValue<sp/>=<sp/>&amp;true_value;</highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].ulValueLen<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(true_value);</highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/>templateCount++;</highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="665"><highlight class="normal"></highlight></codeline>
<codeline lineno="672"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>AES<sp/>için<sp/>key<sp/>size</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="673"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(keyType<sp/>==<sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a8859119f0e92029bcc9c29081d79021aa78a61f5f64f7ea0d31a7cc487d2b14e8" kindref="member">KeyType::AES_256</ref><sp/>&amp;&amp;<sp/>keySize<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="674"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].type<sp/>=<sp/>CKA_VALUE_LEN;<sp/><sp/></highlight></codeline>
<codeline lineno="675"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].pValue<sp/>=<sp/>&amp;keySize;</highlight></codeline>
<codeline lineno="676"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].ulValueLen<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(keySize);</highlight></codeline>
<codeline lineno="677"><highlight class="normal"><sp/><sp/><sp/><sp/>templateCount++;</highlight></codeline>
<codeline lineno="678"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="679"><highlight class="normal"></highlight></codeline>
<codeline lineno="687"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Key<sp/>generate</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/>CK_OBJECT_HANDLE<sp/>keyHandle<sp/>=<sp/>0;<sp/><sp/></highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>rv;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(keyType<sp/>==<sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a8859119f0e92029bcc9c29081d79021aa5b3bf47dace955c9874047820a78d5b8" kindref="member">KeyType::RSA_2048</ref><sp/>||<sp/>keyType<sp/>==<sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a8859119f0e92029bcc9c29081d79021aac5e459c10e5e8348c719df2702c3abe6" kindref="member">KeyType::EC_P256</ref>)<sp/>{</highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Key<sp/>pair<sp/>generation</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/>CK_ATTRIBUTE<sp/>pubTemplate[5];<sp/><sp/></highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/>CK_ULONG<sp/>pubCount<sp/>=<sp/>0;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="701"><highlight class="normal"><sp/><sp/><sp/><sp/>pubTemplate[pubCount].type<sp/>=<sp/>CKA_CLASS;</highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/><sp/><sp/>pubTemplate[pubCount].pValue<sp/>=<sp/>&amp;keyClass;</highlight></codeline>
<codeline lineno="703"><highlight class="normal"><sp/><sp/><sp/><sp/>pubTemplate[pubCount].ulValueLen<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(keyClass);</highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/><sp/><sp/>pubCount++;</highlight></codeline>
<codeline lineno="705"><highlight class="normal"><sp/><sp/><sp/><sp/>pubTemplate[pubCount].type<sp/>=<sp/>CKA_KEY_TYPE;</highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/>pubTemplate[pubCount].pValue<sp/>=<sp/>&amp;ckKeyType;</highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/><sp/><sp/>pubTemplate[pubCount].ulValueLen<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(ckKeyType);</highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><sp/><sp/>pubCount++;</highlight></codeline>
<codeline lineno="709"><highlight class="normal"><sp/><sp/><sp/><sp/>pubTemplate[pubCount].type<sp/>=<sp/>CKA_LABEL;</highlight></codeline>
<codeline lineno="710"><highlight class="normal"><sp/><sp/><sp/><sp/>pubTemplate[pubCount].pValue<sp/>=<sp/></highlight><highlight class="keyword">const_cast&lt;</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(keyLabel);</highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/><sp/><sp/>pubTemplate[pubCount].ulValueLen<sp/>=<sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">CK_ULONG</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(std::strlen(keyLabel));</highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/>pubCount++;</highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/>CK_OBJECT_HANDLE<sp/>pubKeyHandle<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/>rv<sp/>=<sp/>g_pFunctionList-&gt;C_GenerateKeyPair(g_sessionHandle,<sp/>&amp;mechanism,</highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>pubTemplate,<sp/>pubCount,</highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>template_,<sp/>templateCount,</highlight></codeline>
<codeline lineno="717"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;pubKeyHandle,<sp/>&amp;keyHandle);</highlight></codeline>
<codeline lineno="718"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="719"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Secret<sp/>key<sp/>generation</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/><sp/><sp/>rv<sp/>=<sp/>g_pFunctionList-&gt;C_GenerateKey(g_sessionHandle,<sp/>&amp;mechanism,</highlight></codeline>
<codeline lineno="721"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>template_,<sp/>templateCount,<sp/>&amp;keyHandle);</highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="723"><highlight class="normal"></highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rv<sp/>!=<sp/>CKR_OK)<sp/>{</highlight></codeline>
<codeline lineno="725"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>pkcs11ToErrorCode(rv);</highlight></codeline>
<codeline lineno="726"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="727"><highlight class="normal"></highlight></codeline>
<codeline lineno="735"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Key<sp/>ID<sp/>olarak<sp/>handle&apos;ı<sp/>kullan<sp/>(veya<sp/>label&apos;den<sp/>hash)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="736"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(keyIdLen<sp/>&gt;=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(CK_OBJECT_HANDLE))<sp/>{</highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/><sp/><sp/>std::memcpy(keyId,<sp/>&amp;keyHandle,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(CK_OBJECT_HANDLE));</highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/><sp/><sp/>keyIdLen<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(CK_OBJECT_HANDLE);</highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Key<sp/>ID<sp/>çok<sp/>küçükse<sp/>label&apos;den<sp/>hash<sp/>oluştur</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="748"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>labelLen<sp/>=<sp/>std::strlen(keyLabel);</highlight></codeline>
<codeline lineno="749"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>copyLen<sp/>=<sp/>(labelLen<sp/>&lt;<sp/>keyIdLen)<sp/>?<sp/>labelLen<sp/>:<sp/>keyIdLen;</highlight></codeline>
<codeline lineno="750"><highlight class="normal"><sp/><sp/><sp/><sp/>std::memcpy(keyId,<sp/>keyLabel,<sp/>copyLen);</highlight></codeline>
<codeline lineno="751"><highlight class="normal"><sp/><sp/><sp/><sp/>keyIdLen<sp/>=<sp/>copyLen;</highlight></codeline>
<codeline lineno="752"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="753"><highlight class="normal"></highlight></codeline>
<codeline lineno="754"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383daba505a83f220c02df2f85c3810cd9ceb38" kindref="member">ErrorCode::Success</ref>;</highlight></codeline>
<codeline lineno="755"><highlight class="normal">}</highlight></codeline>
<codeline lineno="756"><highlight class="normal"></highlight></codeline>
<codeline lineno="771"><highlight class="normal"><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a6fb8347ca19497bb25f5f0a6e696d96f" kindref="member">ErrorCode</ref><sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1af8527db38f2e8d22d54baf72e43315cf" kindref="member">findKey</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*keyLabel,<sp/>uint8_t<sp/>*keyId,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>&amp;keyIdLen)<sp/>{</highlight></codeline>
<codeline lineno="772"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(g_sessionHandle<sp/>==<sp/>0<sp/>||<sp/>!g_pFunctionList<sp/>||<sp/>!keyLabel<sp/>||<sp/>!keyId)<sp/>{</highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383dabad8f78ca9a692a9411afbc7584b69d043" kindref="member">ErrorCode::InvalidInput</ref>;</highlight></codeline>
<codeline lineno="774"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="775"><highlight class="normal"></highlight></codeline>
<codeline lineno="776"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Template<sp/>ile<sp/>arama</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="777"><highlight class="normal"><sp/><sp/>CK_ATTRIBUTE<sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[3];</highlight></codeline>
<codeline lineno="778"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[0].type<sp/>=<sp/>CKA_CLASS;</highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>keyClass<sp/>=<sp/>CKO_SECRET_KEY;</highlight></codeline>
<codeline lineno="780"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[0].pValue<sp/>=<sp/>&amp;keyClass;</highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[0].ulValueLen<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(keyClass);</highlight></codeline>
<codeline lineno="782"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[1].type<sp/>=<sp/>CKA_KEY_TYPE;</highlight></codeline>
<codeline lineno="783"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>keyType<sp/>=<sp/>CKK_AES;</highlight></codeline>
<codeline lineno="784"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[1].pValue<sp/>=<sp/>&amp;keyType;</highlight></codeline>
<codeline lineno="785"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[1].ulValueLen<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(keyType);</highlight></codeline>
<codeline lineno="786"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[2].type<sp/>=<sp/>CKA_LABEL;</highlight></codeline>
<codeline lineno="787"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[2].pValue<sp/>=<sp/></highlight><highlight class="keyword">const_cast&lt;</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(keyLabel);</highlight></codeline>
<codeline lineno="788"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[2].ulValueLen<sp/>=<sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">CK_ULONG</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(std::strlen(keyLabel));</highlight></codeline>
<codeline lineno="789"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>rv<sp/>=<sp/>g_pFunctionList-&gt;C_FindObjectsInit(g_sessionHandle,<sp/>template_,<sp/>3);</highlight></codeline>
<codeline lineno="790"><highlight class="normal"></highlight></codeline>
<codeline lineno="791"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rv<sp/>!=<sp/>CKR_OK)<sp/>{</highlight></codeline>
<codeline lineno="792"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>pkcs11ToErrorCode(rv);</highlight></codeline>
<codeline lineno="793"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="794"><highlight class="normal"></highlight></codeline>
<codeline lineno="795"><highlight class="normal"><sp/><sp/>CK_OBJECT_HANDLE<sp/>keyHandle<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="796"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>foundCount<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="797"><highlight class="normal"><sp/><sp/>rv<sp/>=<sp/>g_pFunctionList-&gt;C_FindObjects(g_sessionHandle,<sp/>&amp;keyHandle,<sp/>1,<sp/>&amp;foundCount);</highlight></codeline>
<codeline lineno="798"><highlight class="normal"><sp/><sp/>g_pFunctionList-&gt;C_FindObjectsFinal(g_sessionHandle);</highlight></codeline>
<codeline lineno="799"><highlight class="normal"></highlight></codeline>
<codeline lineno="800"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rv<sp/>!=<sp/>CKR_OK<sp/>||<sp/>foundCount<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="801"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383daba2767828026039e8ba7b38973cbb701f2" kindref="member">ErrorCode::FileNotFound</ref>;</highlight></codeline>
<codeline lineno="802"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="803"><highlight class="normal"></highlight></codeline>
<codeline lineno="804"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Key<sp/>ID<sp/>olarak<sp/>handle&apos;ı<sp/>kullan</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="805"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(keyIdLen<sp/>&gt;=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(CK_OBJECT_HANDLE))<sp/>{</highlight></codeline>
<codeline lineno="806"><highlight class="normal"><sp/><sp/><sp/><sp/>std::memcpy(keyId,<sp/>&amp;keyHandle,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(CK_OBJECT_HANDLE));</highlight></codeline>
<codeline lineno="807"><highlight class="normal"><sp/><sp/><sp/><sp/>keyIdLen<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(CK_OBJECT_HANDLE);</highlight></codeline>
<codeline lineno="808"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="809"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383dabad8f78ca9a692a9411afbc7584b69d043" kindref="member">ErrorCode::InvalidInput</ref>;</highlight></codeline>
<codeline lineno="810"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="811"><highlight class="normal"></highlight></codeline>
<codeline lineno="812"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383daba505a83f220c02df2f85c3810cd9ceb38" kindref="member">ErrorCode::Success</ref>;</highlight></codeline>
<codeline lineno="813"><highlight class="normal">}</highlight></codeline>
<codeline lineno="814"><highlight class="normal"></highlight></codeline>
<codeline lineno="828"><highlight class="normal"><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a6fb8347ca19497bb25f5f0a6e696d96f" kindref="member">ErrorCode</ref><sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1aa4b7ad5db79291a92b339855944a4208" kindref="member">deleteKey</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint8_t<sp/>*keyId,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>keyIdLen)<sp/>{</highlight></codeline>
<codeline lineno="829"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(g_sessionHandle<sp/>==<sp/>0<sp/>||<sp/>!g_pFunctionList<sp/>||<sp/>!keyId)<sp/>{</highlight></codeline>
<codeline lineno="830"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383dabad8f78ca9a692a9411afbc7584b69d043" kindref="member">ErrorCode::InvalidInput</ref>;</highlight></codeline>
<codeline lineno="831"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="832"><highlight class="normal"></highlight></codeline>
<codeline lineno="833"><highlight class="normal"><sp/><sp/>CK_OBJECT_HANDLE<sp/>keyHandle<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="834"><highlight class="normal"></highlight></codeline>
<codeline lineno="835"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(keyIdLen<sp/>&gt;=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(CK_OBJECT_HANDLE))<sp/>{</highlight></codeline>
<codeline lineno="836"><highlight class="normal"><sp/><sp/><sp/><sp/>std::memcpy(&amp;keyHandle,<sp/>keyId,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(CK_OBJECT_HANDLE));</highlight></codeline>
<codeline lineno="837"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="838"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383dabad8f78ca9a692a9411afbc7584b69d043" kindref="member">ErrorCode::InvalidInput</ref>;</highlight></codeline>
<codeline lineno="839"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="840"><highlight class="normal"></highlight></codeline>
<codeline lineno="841"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>rv<sp/>=<sp/>g_pFunctionList-&gt;C_DestroyObject(g_sessionHandle,<sp/>keyHandle);</highlight></codeline>
<codeline lineno="842"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>pkcs11ToErrorCode(rv);</highlight></codeline>
<codeline lineno="843"><highlight class="normal">}</highlight></codeline>
<codeline lineno="844"><highlight class="normal"></highlight></codeline>
<codeline lineno="865"><highlight class="normal"><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a6fb8347ca19497bb25f5f0a6e696d96f" kindref="member">ErrorCode</ref><sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1aa76da1d2f45b48a32039219d89930d6b" kindref="member">encrypt</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint8_t<sp/>*keyId,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>keyIdLen,</highlight></codeline>
<codeline lineno="866"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*plaintext,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>plaintextLen,</highlight></codeline>
<codeline lineno="867"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*ciphertext,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>&amp;ciphertextLen,</highlight></codeline>
<codeline lineno="868"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint8_t<sp/>*iv)<sp/>{</highlight></codeline>
<codeline lineno="869"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(g_sessionHandle<sp/>==<sp/>0<sp/>||<sp/>!g_pFunctionList<sp/>||<sp/>!keyId<sp/>||<sp/>!plaintext<sp/>||</highlight></codeline>
<codeline lineno="870"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>plaintextLen<sp/>==<sp/>0<sp/>||<sp/>!ciphertext)<sp/>{</highlight></codeline>
<codeline lineno="871"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383dabad8f78ca9a692a9411afbc7584b69d043" kindref="member">ErrorCode::InvalidInput</ref>;</highlight></codeline>
<codeline lineno="872"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="873"><highlight class="normal"></highlight></codeline>
<codeline lineno="874"><highlight class="normal"><sp/><sp/>CK_OBJECT_HANDLE<sp/>keyHandle<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="875"><highlight class="normal"></highlight></codeline>
<codeline lineno="876"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(keyIdLen<sp/>&gt;=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(CK_OBJECT_HANDLE))<sp/>{</highlight></codeline>
<codeline lineno="877"><highlight class="normal"><sp/><sp/><sp/><sp/>std::memcpy(&amp;keyHandle,<sp/>keyId,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(CK_OBJECT_HANDLE));</highlight></codeline>
<codeline lineno="878"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="879"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383dabad8f78ca9a692a9411afbc7584b69d043" kindref="member">ErrorCode::InvalidInput</ref>;</highlight></codeline>
<codeline lineno="880"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="881"><highlight class="normal"></highlight></codeline>
<codeline lineno="889"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>IV<sp/>oluştur<sp/>(eğer<sp/>verilmemişse)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="890"><highlight class="normal"><sp/><sp/>uint8_t<sp/>localIV[16]<sp/>=<sp/>{<sp/>0<sp/>};<sp/><sp/></highlight></codeline>
<codeline lineno="892"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!iv)<sp/>{</highlight></codeline>
<codeline lineno="894"><highlight class="normal"><sp/><sp/><sp/><sp/>CK_ULONG<sp/>rv<sp/>=<sp/>g_pFunctionList-&gt;C_GenerateRandom(g_sessionHandle,<sp/>localIV,<sp/>16);</highlight></codeline>
<codeline lineno="895"><highlight class="normal"></highlight></codeline>
<codeline lineno="896"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rv<sp/>!=<sp/>CKR_OK)<sp/>{</highlight></codeline>
<codeline lineno="897"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>pkcs11ToErrorCode(rv);</highlight></codeline>
<codeline lineno="898"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="899"><highlight class="normal"></highlight></codeline>
<codeline lineno="900"><highlight class="normal"><sp/><sp/><sp/><sp/>iv<sp/>=<sp/>localIV;</highlight></codeline>
<codeline lineno="901"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="902"><highlight class="normal"></highlight></codeline>
<codeline lineno="910"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>AES-CBC<sp/>mekanizması</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="911"><highlight class="normal"><sp/><sp/>CK_MECHANISM<sp/>mechanism;</highlight></codeline>
<codeline lineno="912"><highlight class="normal"><sp/><sp/>mechanism.mechanism<sp/>=<sp/>CKM_AES_CBC_PAD;<sp/><sp/></highlight></codeline>
<codeline lineno="913"><highlight class="normal"><sp/><sp/>mechanism.pParameter<sp/>=<sp/>iv;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="914"><highlight class="normal"><sp/><sp/>mechanism.ulParameterLen<sp/>=<sp/>16;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="915"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>rv<sp/>=<sp/>g_pFunctionList-&gt;C_EncryptInit(g_sessionHandle,<sp/>&amp;mechanism,<sp/>keyHandle);</highlight></codeline>
<codeline lineno="916"><highlight class="normal"></highlight></codeline>
<codeline lineno="917"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rv<sp/>!=<sp/>CKR_OK)<sp/>{</highlight></codeline>
<codeline lineno="918"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>pkcs11ToErrorCode(rv);</highlight></codeline>
<codeline lineno="919"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="920"><highlight class="normal"></highlight></codeline>
<codeline lineno="921"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Şifreleme</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="922"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>encryptedLen<sp/>=<sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">CK_ULONG</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(ciphertextLen);</highlight></codeline>
<codeline lineno="923"><highlight class="normal"><sp/><sp/>rv<sp/>=<sp/>g_pFunctionList-&gt;C_Encrypt(g_sessionHandle,</highlight></codeline>
<codeline lineno="924"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">CK_BYTE_PTR</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(</highlight><highlight class="keyword">const_cast&lt;</highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(plaintext)),</highlight></codeline>
<codeline lineno="925"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">CK_ULONG</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(plaintextLen),</highlight></codeline>
<codeline lineno="926"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">CK_BYTE_PTR</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(ciphertext),</highlight></codeline>
<codeline lineno="927"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;encryptedLen);</highlight></codeline>
<codeline lineno="928"><highlight class="normal"></highlight></codeline>
<codeline lineno="929"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rv<sp/>!=<sp/>CKR_OK)<sp/>{</highlight></codeline>
<codeline lineno="930"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>pkcs11ToErrorCode(rv);</highlight></codeline>
<codeline lineno="931"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="932"><highlight class="normal"></highlight></codeline>
<codeline lineno="933"><highlight class="normal"><sp/><sp/>ciphertextLen<sp/>=<sp/>encryptedLen;</highlight></codeline>
<codeline lineno="934"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383daba505a83f220c02df2f85c3810cd9ceb38" kindref="member">ErrorCode::Success</ref>;</highlight></codeline>
<codeline lineno="935"><highlight class="normal">}</highlight></codeline>
<codeline lineno="936"><highlight class="normal"></highlight></codeline>
<codeline lineno="957"><highlight class="normal"><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a6fb8347ca19497bb25f5f0a6e696d96f" kindref="member">ErrorCode</ref><sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1af50d97c17003e1b54df285fbf5fa76b9" kindref="member">decrypt</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint8_t<sp/>*keyId,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>keyIdLen,</highlight></codeline>
<codeline lineno="958"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*ciphertext,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>ciphertextLen,</highlight></codeline>
<codeline lineno="959"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*plaintext,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>&amp;plaintextLen,</highlight></codeline>
<codeline lineno="960"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint8_t<sp/>*iv)<sp/>{</highlight></codeline>
<codeline lineno="961"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(g_sessionHandle<sp/>==<sp/>0<sp/>||<sp/>!g_pFunctionList<sp/>||<sp/>!keyId<sp/>||<sp/>!ciphertext<sp/>||</highlight></codeline>
<codeline lineno="962"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>ciphertextLen<sp/>==<sp/>0<sp/>||<sp/>!plaintext)<sp/>{</highlight></codeline>
<codeline lineno="963"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383dabad8f78ca9a692a9411afbc7584b69d043" kindref="member">ErrorCode::InvalidInput</ref>;</highlight></codeline>
<codeline lineno="964"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="965"><highlight class="normal"></highlight></codeline>
<codeline lineno="966"><highlight class="normal"><sp/><sp/>CK_OBJECT_HANDLE<sp/>keyHandle<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="967"><highlight class="normal"></highlight></codeline>
<codeline lineno="968"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(keyIdLen<sp/>&gt;=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(CK_OBJECT_HANDLE))<sp/>{</highlight></codeline>
<codeline lineno="969"><highlight class="normal"><sp/><sp/><sp/><sp/>std::memcpy(&amp;keyHandle,<sp/>keyId,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(CK_OBJECT_HANDLE));</highlight></codeline>
<codeline lineno="970"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="971"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383dabad8f78ca9a692a9411afbc7584b69d043" kindref="member">ErrorCode::InvalidInput</ref>;</highlight></codeline>
<codeline lineno="972"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="973"><highlight class="normal"></highlight></codeline>
<codeline lineno="981"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>IV<sp/>(ciphertext&apos;in<sp/>başından<sp/>okunabilir<sp/>veya<sp/>parametre<sp/>olarak<sp/>verilebilir)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="982"><highlight class="normal"><sp/><sp/>uint8_t<sp/>localIV[16]<sp/>=<sp/>{<sp/>0<sp/>};<sp/><sp/></highlight></codeline>
<codeline lineno="984"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!iv<sp/>&amp;&amp;<sp/>ciphertextLen<sp/>&gt;=<sp/>16)<sp/>{</highlight></codeline>
<codeline lineno="989"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>İlk<sp/>16<sp/>byte<sp/>IV</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="990"><highlight class="normal"><sp/><sp/><sp/><sp/>std::memcpy(localIV,<sp/>ciphertext,<sp/>16);</highlight></codeline>
<codeline lineno="991"><highlight class="normal"><sp/><sp/><sp/><sp/>iv<sp/>=<sp/>localIV;</highlight></codeline>
<codeline lineno="992"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Ciphertext&apos;i<sp/>IV<sp/>olmadan<sp/>düzenle<sp/>(gerçek<sp/>implementasyonda<sp/>dikkatli<sp/>olunmalı)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="993"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!iv)<sp/>{</highlight></codeline>
<codeline lineno="995"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383dabad8f78ca9a692a9411afbc7584b69d043" kindref="member">ErrorCode::InvalidInput</ref>;</highlight></codeline>
<codeline lineno="996"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="997"><highlight class="normal"></highlight></codeline>
<codeline lineno="1004"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>AES-CBC<sp/>mekanizması</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1005"><highlight class="normal"><sp/><sp/>CK_MECHANISM<sp/>mechanism;</highlight></codeline>
<codeline lineno="1006"><highlight class="normal"><sp/><sp/>mechanism.mechanism<sp/>=<sp/>CKM_AES_CBC_PAD;<sp/><sp/></highlight></codeline>
<codeline lineno="1007"><highlight class="normal"><sp/><sp/>mechanism.pParameter<sp/>=<sp/></highlight><highlight class="keyword">const_cast&lt;</highlight><highlight class="normal">uint8_t<sp/>*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(iv);<sp/></highlight></codeline>
<codeline lineno="1008"><highlight class="normal"><sp/><sp/>mechanism.ulParameterLen<sp/>=<sp/>16;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1009"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>rv<sp/>=<sp/>g_pFunctionList-&gt;C_DecryptInit(g_sessionHandle,<sp/>&amp;mechanism,<sp/>keyHandle);</highlight></codeline>
<codeline lineno="1010"><highlight class="normal"></highlight></codeline>
<codeline lineno="1011"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rv<sp/>!=<sp/>CKR_OK)<sp/>{</highlight></codeline>
<codeline lineno="1012"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>pkcs11ToErrorCode(rv);</highlight></codeline>
<codeline lineno="1013"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1014"><highlight class="normal"></highlight></codeline>
<codeline lineno="1015"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Şifre<sp/>çözme</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1016"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>decryptedLen<sp/>=<sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">CK_ULONG</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(plaintextLen);</highlight></codeline>
<codeline lineno="1017"><highlight class="normal"><sp/><sp/>rv<sp/>=<sp/>g_pFunctionList-&gt;C_Decrypt(g_sessionHandle,</highlight></codeline>
<codeline lineno="1018"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">CK_BYTE_PTR</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(</highlight><highlight class="keyword">const_cast&lt;</highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(ciphertext)),</highlight></codeline>
<codeline lineno="1019"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">CK_ULONG</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(ciphertextLen),</highlight></codeline>
<codeline lineno="1020"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">CK_BYTE_PTR</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(plaintext),</highlight></codeline>
<codeline lineno="1021"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;decryptedLen);</highlight></codeline>
<codeline lineno="1022"><highlight class="normal"></highlight></codeline>
<codeline lineno="1023"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rv<sp/>!=<sp/>CKR_OK)<sp/>{</highlight></codeline>
<codeline lineno="1024"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>pkcs11ToErrorCode(rv);</highlight></codeline>
<codeline lineno="1025"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1026"><highlight class="normal"></highlight></codeline>
<codeline lineno="1027"><highlight class="normal"><sp/><sp/>plaintextLen<sp/>=<sp/>decryptedLen;</highlight></codeline>
<codeline lineno="1028"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383daba505a83f220c02df2f85c3810cd9ceb38" kindref="member">ErrorCode::Success</ref>;</highlight></codeline>
<codeline lineno="1029"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1030"><highlight class="normal"></highlight></codeline>
<codeline lineno="1049"><highlight class="normal"><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a6fb8347ca19497bb25f5f0a6e696d96f" kindref="member">ErrorCode</ref><sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1ac14ac62bb1ee91f10908af2ba8f7a832" kindref="member">sign</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint8_t<sp/>*keyId,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>keyIdLen,</highlight></codeline>
<codeline lineno="1050"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*data,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>dataLen,</highlight></codeline>
<codeline lineno="1051"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*signature,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>&amp;signatureLen)<sp/>{</highlight></codeline>
<codeline lineno="1052"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(g_sessionHandle<sp/>==<sp/>0<sp/>||<sp/>!g_pFunctionList<sp/>||<sp/>!keyId<sp/>||<sp/>!data<sp/>||</highlight></codeline>
<codeline lineno="1053"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>dataLen<sp/>==<sp/>0<sp/>||<sp/>!signature)<sp/>{</highlight></codeline>
<codeline lineno="1054"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383dabad8f78ca9a692a9411afbc7584b69d043" kindref="member">ErrorCode::InvalidInput</ref>;</highlight></codeline>
<codeline lineno="1055"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1056"><highlight class="normal"></highlight></codeline>
<codeline lineno="1057"><highlight class="normal"><sp/><sp/>CK_OBJECT_HANDLE<sp/>keyHandle<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1058"><highlight class="normal"></highlight></codeline>
<codeline lineno="1059"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(keyIdLen<sp/>&gt;=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(CK_OBJECT_HANDLE))<sp/>{</highlight></codeline>
<codeline lineno="1060"><highlight class="normal"><sp/><sp/><sp/><sp/>std::memcpy(&amp;keyHandle,<sp/>keyId,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(CK_OBJECT_HANDLE));</highlight></codeline>
<codeline lineno="1061"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1062"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383dabad8f78ca9a692a9411afbc7584b69d043" kindref="member">ErrorCode::InvalidInput</ref>;</highlight></codeline>
<codeline lineno="1063"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1064"><highlight class="normal"></highlight></codeline>
<codeline lineno="1071"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>SHA256-RSA-PKCS<sp/>mechanism</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1072"><highlight class="normal"><sp/><sp/>CK_MECHANISM<sp/>mechanism;</highlight></codeline>
<codeline lineno="1073"><highlight class="normal"><sp/><sp/>mechanism.mechanism<sp/>=<sp/>CKM_SHA256_RSA_PKCS;<sp/><sp/></highlight></codeline>
<codeline lineno="1074"><highlight class="normal"><sp/><sp/>mechanism.pParameter<sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1075"><highlight class="normal"><sp/><sp/>mechanism.ulParameterLen<sp/>=<sp/>0;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1082"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>rv<sp/>=<sp/>g_pFunctionList-&gt;C_SignInit(g_sessionHandle,<sp/>&amp;mechanism,<sp/>keyHandle);</highlight></codeline>
<codeline lineno="1083"><highlight class="normal"></highlight></codeline>
<codeline lineno="1084"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rv<sp/>!=<sp/>CKR_OK)<sp/>{</highlight></codeline>
<codeline lineno="1085"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>pkcs11ToErrorCode(rv);</highlight></codeline>
<codeline lineno="1086"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1087"><highlight class="normal"></highlight></codeline>
<codeline lineno="1095"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>İmzalama</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1096"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>sigLen<sp/>=<sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">CK_ULONG</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(signatureLen);<sp/><sp/></highlight></codeline>
<codeline lineno="1097"><highlight class="normal"><sp/><sp/>rv<sp/>=<sp/>g_pFunctionList-&gt;C_Sign(g_sessionHandle,</highlight></codeline>
<codeline lineno="1098"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">CK_BYTE_PTR</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(</highlight><highlight class="keyword">const_cast&lt;</highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(data)),</highlight></codeline>
<codeline lineno="1099"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">CK_ULONG</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(dataLen),</highlight></codeline>
<codeline lineno="1100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">CK_BYTE_PTR</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(signature),</highlight></codeline>
<codeline lineno="1101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>&amp;sigLen);</highlight></codeline>
<codeline lineno="1102"><highlight class="normal"></highlight></codeline>
<codeline lineno="1103"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rv<sp/>!=<sp/>CKR_OK)<sp/>{</highlight></codeline>
<codeline lineno="1104"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>pkcs11ToErrorCode(rv);</highlight></codeline>
<codeline lineno="1105"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1106"><highlight class="normal"></highlight></codeline>
<codeline lineno="1107"><highlight class="normal"><sp/><sp/>signatureLen<sp/>=<sp/>sigLen;</highlight></codeline>
<codeline lineno="1108"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383daba505a83f220c02df2f85c3810cd9ceb38" kindref="member">ErrorCode::Success</ref>;</highlight></codeline>
<codeline lineno="1109"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1110"><highlight class="normal"></highlight></codeline>
<codeline lineno="1128"><highlight class="normal"></highlight><highlight class="keywordtype">bool</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a6e1b43ac34b60670eafe4cb1c347335a" kindref="member">verify</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint8_t<sp/>*keyId,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>keyIdLen,</highlight></codeline>
<codeline lineno="1129"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*data,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>dataLen,</highlight></codeline>
<codeline lineno="1130"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*signature,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>signatureLen)<sp/>{</highlight></codeline>
<codeline lineno="1131"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(g_sessionHandle<sp/>==<sp/>0<sp/>||<sp/>!g_pFunctionList<sp/>||<sp/>!keyId<sp/>||<sp/>!data<sp/>||</highlight></codeline>
<codeline lineno="1132"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>dataLen<sp/>==<sp/>0<sp/>||<sp/>!signature<sp/>||<sp/>signatureLen<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1133"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1134"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1135"><highlight class="normal"></highlight></codeline>
<codeline lineno="1136"><highlight class="normal"><sp/><sp/>CK_OBJECT_HANDLE<sp/>keyHandle<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1137"><highlight class="normal"></highlight></codeline>
<codeline lineno="1138"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(keyIdLen<sp/>&gt;=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(CK_OBJECT_HANDLE))<sp/>{</highlight></codeline>
<codeline lineno="1139"><highlight class="normal"><sp/><sp/><sp/><sp/>std::memcpy(&amp;keyHandle,<sp/>keyId,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(CK_OBJECT_HANDLE));</highlight></codeline>
<codeline lineno="1140"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1141"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1142"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1143"><highlight class="normal"></highlight></codeline>
<codeline lineno="1150"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>SHA256-RSA-PKCS<sp/>mechanism</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1151"><highlight class="normal"><sp/><sp/>CK_MECHANISM<sp/>mechanism;</highlight></codeline>
<codeline lineno="1152"><highlight class="normal"><sp/><sp/>mechanism.mechanism<sp/>=<sp/>CKM_SHA256_RSA_PKCS;<sp/><sp/></highlight></codeline>
<codeline lineno="1153"><highlight class="normal"><sp/><sp/>mechanism.pParameter<sp/>=<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1154"><highlight class="normal"><sp/><sp/>mechanism.ulParameterLen<sp/>=<sp/>0;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1161"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>rv<sp/>=<sp/>g_pFunctionList-&gt;C_VerifyInit(g_sessionHandle,<sp/>&amp;mechanism,<sp/>keyHandle);</highlight></codeline>
<codeline lineno="1162"><highlight class="normal"></highlight></codeline>
<codeline lineno="1163"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rv<sp/>!=<sp/>CKR_OK)<sp/>{</highlight></codeline>
<codeline lineno="1164"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/></highlight><highlight class="keyword">false</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1165"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1166"><highlight class="normal"></highlight></codeline>
<codeline lineno="1173"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Doğrulama</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1174"><highlight class="normal"><sp/><sp/>rv<sp/>=<sp/>g_pFunctionList-&gt;C_Verify(g_sessionHandle,</highlight></codeline>
<codeline lineno="1175"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">CK_BYTE_PTR</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(</highlight><highlight class="keyword">const_cast&lt;</highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(data)),</highlight></codeline>
<codeline lineno="1176"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">CK_ULONG</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(dataLen),</highlight></codeline>
<codeline lineno="1177"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">CK_BYTE_PTR</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(</highlight><highlight class="keyword">const_cast&lt;</highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(signature)),</highlight></codeline>
<codeline lineno="1178"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">CK_ULONG</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(signatureLen));</highlight></codeline>
<codeline lineno="1179"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(rv<sp/>==<sp/>CKR_OK);<sp/><sp/></highlight></codeline>
<codeline lineno="1180"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1181"><highlight class="normal"></highlight></codeline>
<codeline lineno="1195"><highlight class="normal"><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a6fb8347ca19497bb25f5f0a6e696d96f" kindref="member">ErrorCode</ref><sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1ac132d386ec4642b70cbfc87db1dd84f3" kindref="member">generateRandom</ref>(uint8_t<sp/>*output,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>length)<sp/>{</highlight></codeline>
<codeline lineno="1196"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(g_sessionHandle<sp/>==<sp/>0<sp/>||<sp/>!g_pFunctionList<sp/>||<sp/>!output<sp/>||<sp/>length<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1197"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383dabad8f78ca9a692a9411afbc7584b69d043" kindref="member">ErrorCode::InvalidInput</ref>;</highlight></codeline>
<codeline lineno="1198"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1199"><highlight class="normal"></highlight></codeline>
<codeline lineno="1200"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>rv<sp/>=<sp/>g_pFunctionList-&gt;C_GenerateRandom(g_sessionHandle,<sp/>output,</highlight></codeline>
<codeline lineno="1201"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">CK_ULONG</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(length));</highlight></codeline>
<codeline lineno="1202"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>pkcs11ToErrorCode(rv);</highlight></codeline>
<codeline lineno="1203"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1204"><highlight class="normal"></highlight></codeline>
<codeline lineno="1219"><highlight class="normal"><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a6fb8347ca19497bb25f5f0a6e696d96f" kindref="member">ErrorCode</ref><sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a627d80f41250c6562b1cd91521787245" kindref="member">listTokens</ref>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>labels[][64],<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>&amp;count)<sp/>{</highlight></codeline>
<codeline lineno="1220"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(g_status<sp/>!=<sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1aad0a58fc42af71a6793bf6449a75b24aadee5f03c2c4e73657824e028494b18c0" kindref="member">InitStatus::INITIALIZED</ref><sp/>||<sp/>!g_pFunctionList<sp/>||<sp/>!labels)<sp/>{</highlight></codeline>
<codeline lineno="1221"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383dabad8f78ca9a692a9411afbc7584b69d043" kindref="member">ErrorCode::InvalidInput</ref>;</highlight></codeline>
<codeline lineno="1222"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1223"><highlight class="normal"></highlight></codeline>
<codeline lineno="1224"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>slotCount<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1225"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>rv<sp/>=<sp/>g_pFunctionList-&gt;C_GetSlotList(CK_TRUE,<sp/></highlight><highlight class="keyword">nullptr</highlight><highlight class="normal">,<sp/>&amp;slotCount);</highlight></codeline>
<codeline lineno="1226"><highlight class="normal"></highlight></codeline>
<codeline lineno="1227"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rv<sp/>!=<sp/>CKR_OK<sp/>||<sp/>slotCount<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1228"><highlight class="normal"><sp/><sp/><sp/><sp/>count<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1229"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>pkcs11ToErrorCode(rv);</highlight></codeline>
<codeline lineno="1230"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1231"><highlight class="normal"></highlight></codeline>
<codeline lineno="1232"><highlight class="normal"><sp/><sp/>std::vector&lt;CK_SLOT_ID&gt;<sp/>slots(slotCount);</highlight></codeline>
<codeline lineno="1233"><highlight class="normal"><sp/><sp/>rv<sp/>=<sp/>g_pFunctionList-&gt;C_GetSlotList(CK_TRUE,<sp/>slots.data(),<sp/>&amp;slotCount);</highlight></codeline>
<codeline lineno="1234"><highlight class="normal"></highlight></codeline>
<codeline lineno="1235"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rv<sp/>!=<sp/>CKR_OK)<sp/>{</highlight></codeline>
<codeline lineno="1236"><highlight class="normal"><sp/><sp/><sp/><sp/>count<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1237"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>pkcs11ToErrorCode(rv);</highlight></codeline>
<codeline lineno="1238"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1239"><highlight class="normal"></highlight></codeline>
<codeline lineno="1248"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>foundCount<sp/>=<sp/>0;<sp/><sp/></highlight></codeline>
<codeline lineno="1250"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(CK_ULONG<sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>slotCount<sp/>&amp;&amp;<sp/>foundCount<sp/>&lt;<sp/>count<sp/>&amp;&amp;<sp/>foundCount<sp/>&lt;<sp/>10;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="1251"><highlight class="normal"><sp/><sp/><sp/><sp/>CK_TOKEN_INFO<sp/>tokenInfo;<sp/><sp/></highlight></codeline>
<codeline lineno="1252"><highlight class="normal"><sp/><sp/><sp/><sp/>rv<sp/>=<sp/>g_pFunctionList-&gt;C_GetTokenInfo(slots[i],<sp/>&amp;tokenInfo);</highlight></codeline>
<codeline lineno="1253"><highlight class="normal"></highlight></codeline>
<codeline lineno="1254"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rv<sp/>==<sp/>CKR_OK)<sp/>{</highlight></codeline>
<codeline lineno="1261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Label&apos;i<sp/>kopyala<sp/>(32<sp/>byte,<sp/>boşluklarla<sp/>doldurulmuş)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespace_travel_expense_1_1_safe_string_1a5555a53d845f3644d0dfc17c0f097075" kindref="member">SafeString::safeCopy</ref>(labels[foundCount],<sp/>64,<sp/>tokenInfo.label);</highlight></codeline>
<codeline lineno="1263"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Son<sp/>boşlukları<sp/>temizle</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>len<sp/>=<sp/>std::strlen(labels[foundCount]);</highlight></codeline>
<codeline lineno="1265"><highlight class="normal"></highlight></codeline>
<codeline lineno="1266"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(len<sp/>&gt;<sp/>0<sp/>&amp;&amp;<sp/>labels[foundCount][len<sp/>-<sp/>1]<sp/>==<sp/></highlight><highlight class="charliteral">&apos;<sp/>&apos;</highlight><highlight class="normal">)<sp/>{</highlight></codeline>
<codeline lineno="1267"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>labels[foundCount][--len]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1268"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1269"><highlight class="normal"></highlight></codeline>
<codeline lineno="1270"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>foundCount++;</highlight></codeline>
<codeline lineno="1271"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1272"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1273"><highlight class="normal"></highlight></codeline>
<codeline lineno="1274"><highlight class="normal"><sp/><sp/>count<sp/>=<sp/>foundCount;</highlight></codeline>
<codeline lineno="1275"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383daba505a83f220c02df2f85c3810cd9ceb38" kindref="member">ErrorCode::Success</ref>;</highlight></codeline>
<codeline lineno="1276"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1277"><highlight class="normal"></highlight></codeline>
<codeline lineno="1292"><highlight class="normal"><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a6fb8347ca19497bb25f5f0a6e696d96f" kindref="member">ErrorCode</ref><sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1ae037de28b34ae8a110a65f222e52ac06" kindref="member">listKeys</ref>(</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>labels[][64],<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>&amp;count)<sp/>{</highlight></codeline>
<codeline lineno="1293"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(g_sessionHandle<sp/>==<sp/>0<sp/>||<sp/>!g_pFunctionList<sp/>||<sp/>!labels)<sp/>{</highlight></codeline>
<codeline lineno="1294"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383dabad8f78ca9a692a9411afbc7584b69d043" kindref="member">ErrorCode::InvalidInput</ref>;</highlight></codeline>
<codeline lineno="1295"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1296"><highlight class="normal"></highlight></codeline>
<codeline lineno="1297"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Tüm<sp/>secret<sp/>key&apos;leri<sp/>bul</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1298"><highlight class="normal"><sp/><sp/>CK_ATTRIBUTE<sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[1];</highlight></codeline>
<codeline lineno="1299"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>keyClass<sp/>=<sp/>CKO_SECRET_KEY;</highlight></codeline>
<codeline lineno="1300"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[0].type<sp/>=<sp/>CKA_CLASS;</highlight></codeline>
<codeline lineno="1301"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[0].pValue<sp/>=<sp/>&amp;keyClass;</highlight></codeline>
<codeline lineno="1302"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[0].ulValueLen<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(keyClass);</highlight></codeline>
<codeline lineno="1303"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>rv<sp/>=<sp/>g_pFunctionList-&gt;C_FindObjectsInit(g_sessionHandle,<sp/>template_,<sp/>1);</highlight></codeline>
<codeline lineno="1304"><highlight class="normal"></highlight></codeline>
<codeline lineno="1305"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rv<sp/>!=<sp/>CKR_OK)<sp/>{</highlight></codeline>
<codeline lineno="1306"><highlight class="normal"><sp/><sp/><sp/><sp/>count<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="1307"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>pkcs11ToErrorCode(rv);</highlight></codeline>
<codeline lineno="1308"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1309"><highlight class="normal"></highlight></codeline>
<codeline lineno="1317"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>foundCount<sp/>=<sp/>0;<sp/><sp/></highlight></codeline>
<codeline lineno="1318"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>maxKeys<sp/>=<sp/>(count<sp/>&lt;<sp/>50)<sp/>?<sp/>count<sp/>:<sp/>50;<sp/><sp/></highlight></codeline>
<codeline lineno="1327"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(</highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>maxKeys;<sp/>++i)<sp/>{</highlight></codeline>
<codeline lineno="1328"><highlight class="normal"><sp/><sp/><sp/><sp/>CK_OBJECT_HANDLE<sp/>keyHandle<sp/>=<sp/>0;<sp/><sp/></highlight></codeline>
<codeline lineno="1329"><highlight class="normal"><sp/><sp/><sp/><sp/>CK_ULONG<sp/>objCount<sp/>=<sp/>0;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1330"><highlight class="normal"><sp/><sp/><sp/><sp/>rv<sp/>=<sp/>g_pFunctionList-&gt;C_FindObjects(g_sessionHandle,<sp/>&amp;keyHandle,<sp/>1,<sp/>&amp;objCount);</highlight></codeline>
<codeline lineno="1331"><highlight class="normal"></highlight></codeline>
<codeline lineno="1332"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rv<sp/>!=<sp/>CKR_OK<sp/>||<sp/>objCount<sp/>==<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1335"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1336"><highlight class="normal"></highlight></codeline>
<codeline lineno="1343"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>Label<sp/>attribute&apos;unu<sp/>al</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1344"><highlight class="normal"><sp/><sp/><sp/><sp/>CK_ATTRIBUTE<sp/>attr;</highlight></codeline>
<codeline lineno="1345"><highlight class="normal"><sp/><sp/><sp/><sp/>attr.type<sp/>=<sp/>CKA_LABEL;<sp/><sp/></highlight></codeline>
<codeline lineno="1346"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>labelBuffer[64]<sp/>=<sp/>{<sp/>0<sp/>};<sp/><sp/></highlight></codeline>
<codeline lineno="1347"><highlight class="normal"><sp/><sp/><sp/><sp/>attr.pValue<sp/>=<sp/>labelBuffer;</highlight></codeline>
<codeline lineno="1348"><highlight class="normal"><sp/><sp/><sp/><sp/>attr.ulValueLen<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(labelBuffer)<sp/>-<sp/>1;<sp/><sp/></highlight></codeline>
<codeline lineno="1349"><highlight class="normal"><sp/><sp/><sp/><sp/>rv<sp/>=<sp/>g_pFunctionList-&gt;C_GetAttributeValue(g_sessionHandle,<sp/>keyHandle,<sp/>&amp;attr,<sp/>1);</highlight></codeline>
<codeline lineno="1350"><highlight class="normal"></highlight></codeline>
<codeline lineno="1351"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rv<sp/>==<sp/>CKR_OK<sp/>&amp;&amp;<sp/>attr.ulValueLen<sp/>&gt;<sp/>0)<sp/>{</highlight></codeline>
<codeline lineno="1353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="namespace_travel_expense_1_1_safe_string_1a5555a53d845f3644d0dfc17c0f097075" kindref="member">SafeString::safeCopy</ref>(labels[foundCount],<sp/>64,<sp/>labelBuffer);</highlight></codeline>
<codeline lineno="1354"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>labels[foundCount][63]<sp/>=<sp/></highlight><highlight class="charliteral">&apos;\0&apos;</highlight><highlight class="normal">;<sp/><sp/></highlight></codeline>
<codeline lineno="1355"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>foundCount++;</highlight></codeline>
<codeline lineno="1356"><highlight class="normal"><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="1357"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1358"><highlight class="normal"></highlight></codeline>
<codeline lineno="1359"><highlight class="normal"><sp/><sp/>g_pFunctionList-&gt;C_FindObjectsFinal(g_sessionHandle);</highlight></codeline>
<codeline lineno="1360"><highlight class="normal"><sp/><sp/>count<sp/>=<sp/>foundCount;</highlight></codeline>
<codeline lineno="1361"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383daba505a83f220c02df2f85c3810cd9ceb38" kindref="member">ErrorCode::Success</ref>;</highlight></codeline>
<codeline lineno="1362"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1363"><highlight class="normal"></highlight></codeline>
<codeline lineno="1382"><highlight class="normal"><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a6fb8347ca19497bb25f5f0a6e696d96f" kindref="member">ErrorCode</ref><sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a04b9cc48d95cd483ab84818c43ed967d" kindref="member">importKey</ref>(<ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a8859119f0e92029bcc9c29081d79021a" kindref="member">KeyType</ref><sp/>keyType,</highlight></codeline>
<codeline lineno="1383"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint8_t<sp/>*keyData,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>keyDataLen,</highlight></codeline>
<codeline lineno="1384"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*keyLabel,<sp/>uint8_t<sp/>*keyId,<sp/></highlight><highlight class="keywordtype">size_t</highlight><highlight class="normal"><sp/>&amp;keyIdLen)<sp/>{</highlight></codeline>
<codeline lineno="1385"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(g_sessionHandle<sp/>==<sp/>0<sp/>||<sp/>!g_pFunctionList<sp/>||<sp/>!keyData<sp/>||<sp/>keyDataLen<sp/>==<sp/>0<sp/>||</highlight></codeline>
<codeline lineno="1386"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>!keyLabel<sp/>||<sp/>!keyId)<sp/>{</highlight></codeline>
<codeline lineno="1387"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383dabad8f78ca9a692a9411afbc7584b69d043" kindref="member">ErrorCode::InvalidInput</ref>;</highlight></codeline>
<codeline lineno="1388"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1389"><highlight class="normal"></highlight></codeline>
<codeline lineno="1396"><highlight class="normal"><sp/><sp/>CK_ATTRIBUTE<sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[10];<sp/><sp/></highlight></codeline>
<codeline lineno="1397"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>templateCount<sp/>=<sp/>0;<sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1398"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>keyClass<sp/>=<sp/>CKO_SECRET_KEY;<sp/><sp/></highlight></codeline>
<codeline lineno="1399"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>ckKeyType<sp/>=<sp/>CKK_AES;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1400"><highlight class="normal"><sp/><sp/>CK_BYTE<sp/>true_value<sp/>=<sp/>CK_TRUE;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1410"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(keyType)<sp/>{</highlight></codeline>
<codeline lineno="1411"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a8859119f0e92029bcc9c29081d79021aa78a61f5f64f7ea0d31a7cc487d2b14e8" kindref="member">KeyType::AES_256</ref>:</highlight></codeline>
<codeline lineno="1412"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>ckKeyType<sp/>=<sp/>CKK_AES;</highlight></codeline>
<codeline lineno="1413"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1414"><highlight class="normal"></highlight></codeline>
<codeline lineno="1415"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a8859119f0e92029bcc9c29081d79021aa5b3bf47dace955c9874047820a78d5b8" kindref="member">KeyType::RSA_2048</ref>:</highlight></codeline>
<codeline lineno="1416"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>keyClass<sp/>=<sp/>CKO_PRIVATE_KEY;</highlight></codeline>
<codeline lineno="1417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>ckKeyType<sp/>=<sp/>CKK_RSA;</highlight></codeline>
<codeline lineno="1418"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1419"><highlight class="normal"></highlight></codeline>
<codeline lineno="1420"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1_1_soft_h_s_m_1a8859119f0e92029bcc9c29081d79021aac5e459c10e5e8348c719df2702c3abe6" kindref="member">KeyType::EC_P256</ref>:</highlight></codeline>
<codeline lineno="1421"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>keyClass<sp/>=<sp/>CKO_PRIVATE_KEY;</highlight></codeline>
<codeline lineno="1422"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/>ckKeyType<sp/>=<sp/>CKK_EC;</highlight></codeline>
<codeline lineno="1423"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="1424"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1425"><highlight class="normal"></highlight></codeline>
<codeline lineno="1437"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].type<sp/>=<sp/>CKA_CLASS;<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1438"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].pValue<sp/>=<sp/>&amp;keyClass;</highlight></codeline>
<codeline lineno="1439"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].ulValueLen<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(keyClass);</highlight></codeline>
<codeline lineno="1440"><highlight class="normal"><sp/><sp/>templateCount++;</highlight></codeline>
<codeline lineno="1441"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].type<sp/>=<sp/>CKA_KEY_TYPE;<sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1442"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].pValue<sp/>=<sp/>&amp;ckKeyType;</highlight></codeline>
<codeline lineno="1443"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].ulValueLen<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(ckKeyType);</highlight></codeline>
<codeline lineno="1444"><highlight class="normal"><sp/><sp/>templateCount++;</highlight></codeline>
<codeline lineno="1445"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].type<sp/>=<sp/>CKA_LABEL;<sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1446"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].pValue<sp/>=<sp/></highlight><highlight class="keyword">const_cast&lt;</highlight><highlight class="keywordtype">char</highlight><highlight class="normal"><sp/>*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(keyLabel);</highlight></codeline>
<codeline lineno="1447"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].ulValueLen<sp/>=<sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">CK_ULONG</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(std::strlen(keyLabel));</highlight></codeline>
<codeline lineno="1448"><highlight class="normal"><sp/><sp/>templateCount++;</highlight></codeline>
<codeline lineno="1449"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].type<sp/>=<sp/>CKA_VALUE;<sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1450"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].pValue<sp/>=<sp/></highlight><highlight class="keyword">const_cast&lt;</highlight><highlight class="normal">uint8_t<sp/>*</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(keyData);</highlight></codeline>
<codeline lineno="1451"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].ulValueLen<sp/>=<sp/></highlight><highlight class="keyword">static_cast&lt;</highlight><highlight class="normal">CK_ULONG</highlight><highlight class="keyword">&gt;</highlight><highlight class="normal">(keyDataLen);</highlight></codeline>
<codeline lineno="1452"><highlight class="normal"><sp/><sp/>templateCount++;</highlight></codeline>
<codeline lineno="1453"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].type<sp/>=<sp/>CKA_TOKEN;<sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1454"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].pValue<sp/>=<sp/>&amp;true_value;</highlight></codeline>
<codeline lineno="1455"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].ulValueLen<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(true_value);</highlight></codeline>
<codeline lineno="1456"><highlight class="normal"><sp/><sp/>templateCount++;</highlight></codeline>
<codeline lineno="1457"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].type<sp/>=<sp/>CKA_ENCRYPT;<sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1458"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].pValue<sp/>=<sp/>&amp;true_value;</highlight></codeline>
<codeline lineno="1459"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].ulValueLen<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(true_value);</highlight></codeline>
<codeline lineno="1460"><highlight class="normal"><sp/><sp/>templateCount++;</highlight></codeline>
<codeline lineno="1461"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].type<sp/>=<sp/>CKA_DECRYPT;<sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="1462"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].pValue<sp/>=<sp/>&amp;true_value;</highlight></codeline>
<codeline lineno="1463"><highlight class="normal"><sp/><sp/></highlight><highlight class="keyword">template</highlight><highlight class="normal">_[templateCount].ulValueLen<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(true_value);</highlight></codeline>
<codeline lineno="1464"><highlight class="normal"><sp/><sp/>templateCount++;</highlight></codeline>
<codeline lineno="1471"><highlight class="normal"><sp/><sp/>CK_OBJECT_HANDLE<sp/>keyHandle<sp/>=<sp/>0;<sp/><sp/></highlight></codeline>
<codeline lineno="1472"><highlight class="normal"><sp/><sp/>CK_ULONG<sp/>rv<sp/>=<sp/>g_pFunctionList-&gt;C_CreateObject(g_sessionHandle,<sp/>template_,</highlight></codeline>
<codeline lineno="1473"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>templateCount,<sp/>&amp;keyHandle);</highlight></codeline>
<codeline lineno="1474"><highlight class="normal"></highlight></codeline>
<codeline lineno="1475"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(rv<sp/>!=<sp/>CKR_OK)<sp/>{</highlight></codeline>
<codeline lineno="1476"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>pkcs11ToErrorCode(rv);</highlight></codeline>
<codeline lineno="1477"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1478"><highlight class="normal"></highlight></codeline>
<codeline lineno="1486"><highlight class="normal"><sp/><sp/></highlight><highlight class="comment">//<sp/>Key<sp/>ID<sp/>olarak<sp/>handle&apos;ı<sp/>kullan</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1487"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(keyIdLen<sp/>&gt;=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(CK_OBJECT_HANDLE))<sp/>{</highlight></codeline>
<codeline lineno="1489"><highlight class="normal"><sp/><sp/><sp/><sp/>std::memcpy(keyId,<sp/>&amp;keyHandle,<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(CK_OBJECT_HANDLE));</highlight></codeline>
<codeline lineno="1490"><highlight class="normal"><sp/><sp/><sp/><sp/>keyIdLen<sp/>=<sp/></highlight><highlight class="keyword">sizeof</highlight><highlight class="normal">(CK_OBJECT_HANDLE);</highlight></codeline>
<codeline lineno="1491"><highlight class="normal"><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="1498"><highlight class="normal"><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383dabad8f78ca9a692a9411afbc7584b69d043" kindref="member">ErrorCode::InvalidInput</ref>;</highlight></codeline>
<codeline lineno="1499"><highlight class="normal"><sp/><sp/>}</highlight></codeline>
<codeline lineno="1500"><highlight class="normal"></highlight></codeline>
<codeline lineno="1501"><highlight class="normal"><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="namespace_travel_expense_1a3bda90e999d060d311aeaafaca383daba505a83f220c02df2f85c3810cd9ceb38" kindref="member">ErrorCode::Success</ref>;</highlight></codeline>
<codeline lineno="1502"><highlight class="normal">}</highlight></codeline>
<codeline lineno="1503"><highlight class="normal"></highlight></codeline>
<codeline lineno="1504"><highlight class="normal">}<sp/></highlight><highlight class="comment">//<sp/>namespace<sp/>SoftHSM</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1505"><highlight class="normal"></highlight></codeline>
<codeline lineno="1506"><highlight class="normal">}<sp/></highlight><highlight class="comment">//<sp/>namespace<sp/>TravelExpense</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="1507"><highlight class="normal"></highlight></codeline>
    </programlisting>
    <location file="src/travelexpense/src/softhsm.cpp"/>
  </compounddef>
</doxygen>
